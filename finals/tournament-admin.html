<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTERNET OLYMPICS 2 - Tournament Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #008080;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: linear-gradient(to right, #000080, #1084d0);
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
            border: 2px solid #000;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        /* Tab Navigation */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            background: #fff;
            border: 2px solid #000;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .tab:hover {
            background: #f0f0f0;
        }

        .tab.active {
            background: #ffd700;
            transform: translateY(-2px);
        }

        /* Content Panels */
        .panel {
            display: none;
            background: #fff;
            border: 2px solid #000;
            padding: 20px;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
        }

        .panel.active {
            display: block;
        }

        /* Setup Panel */
        .player-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .player-item {
            background: #f0f0f0;
            padding: 10px;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border: 2px solid #000;
        }

        /* Match Management */
        .round-section {
            margin-bottom: 30px;
        }

        .round-header {
            background: #000080;
            color: white;
            padding: 10px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .match {
            background: #f9f9f9;
            border: 2px solid #ddd;
            margin-bottom: 10px;
            padding: 15px;
        }

        .match.active {
            border-color: #ffd700;
            background: #fffacd;
        }

        .match-players {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 10px;
        }

        .player-box {
            flex: 1;
            padding: 10px;
            background: #fff;
            border: 2px solid #ccc;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .player-box:hover {
            background: #e0e0e0;
        }

        .player-box.winner {
            background: #90ee90;
            border-color: #228b22;
            font-weight: bold;
        }

        .vs {
            font-weight: bold;
            color: #ff0000;
        }

        /* Bracket View */
        .bracket-view {
            display: flex;
            gap: 50px;
            overflow-x: auto;
            padding: 20px;
            background: #333;
            border-radius: 10px;
        }

        .bracket-round {
            min-width: 250px;
        }

        .bracket-match {
            background: rgba(255,255,255,0.9);
            border: 2px solid #000;
            margin-bottom: 20px;
            border-radius: 5px;
            overflow: hidden;
        }

        .bracket-player {
            padding: 10px;
            border-bottom: 1px solid #ccc;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bracket-player:last-child {
            border-bottom: none;
        }

        .bracket-player.winner {
            background: #90ee90;
            font-weight: bold;
        }

        .bracket-player.loser {
            opacity: 0.5;
        }

        /* Buttons */
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn.secondary {
            background: #008CBA;
        }

        .btn.danger {
            background: #f44336;
        }

        /* Champion Display */
        .champion-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border: 3px solid #000;
            margin-top: 20px;
        }

        .champion-display h2 {
            font-size: 36px;
            margin-bottom: 20px;
        }

        .champion-avatar {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border: 5px solid #000;
            margin: 0 auto;
            display: block;
        }

        /* Status Messages */
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            display: none;
        }

        .status.show {
            display: block;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ INTERNET OLYMPICS 2 - TOURNAMENT MANAGER üèÜ</h1>
            <p>14 finalists. Single elimination. One champion.</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('setup')">üìã Setup</div>
            <div class="tab" onclick="showTab('manage')">‚öîÔ∏è Manage Matches</div>
            <div class="tab" onclick="showTab('bracket')">üèÜ View Bracket</div>
        </div>

        <div id="status" class="status"></div>

        <!-- Setup Panel -->
        <div id="setup-panel" class="panel active">
            <h2>Tournament Setup</h2>
            <p style="margin-bottom: 20px;">These are your 14 finalists:</p>
            
            <div class="player-grid" id="playerList"></div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="initializeTournament()">üé≤ Generate Random Bracket</button>
                <button class="btn danger" onclick="resetTournament()">üîÑ Reset Everything</button>
            </div>
        </div>

        <!-- Manage Matches Panel -->
        <div id="manage-panel" class="panel">
            <h2>Manage Matches</h2>
            <div id="matchManagement">
                <p style="text-align: center; padding: 50px; color: #666;">
                    Initialize the tournament first to manage matches.
                </p>
            </div>
        </div>

        <!-- Bracket View Panel -->
        <div id="bracket-panel" class="panel">
            <h2>Tournament Bracket</h2>
            <div id="bracketView">
                <p style="text-align: center; padding: 50px; color: #666;">
                    Initialize the tournament first to view the bracket.
                </p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getFirestore, 
            doc, 
            getDoc,
            setDoc,
            onSnapshot
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDJ8uiR2qEUfXIuFEO2l-40668WNpQdj2w",
            authDomain: "c0uchz0mb13.firebaseapp.com",
            projectId: "c0uchz0mb13",
            storageBucket: "c0uchz0mb13.firebasestorage.app",
            messagingSenderId: "1051521591004",
            appId: "1:1051521591004:web:1301f129fc0f3032f6f619",
            measurementId: "G-6BNDYZQRPE"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Players
        const players = [
            'duckgirl808', 'edouardstone', 'hauntyourownhouse', 
            'michaelmelwani', 'littleurbanachiever', 'minibearbeats',
            'nataliesomekh', 'normalmiette', 'pintallica', 'plascu',
            'pretzelness', 'tempe', 'thecornii', 'whoiskaybrown'
        ];

        let tournamentData = null;
        const tournamentRef = doc(db, 'simple_tournament', 'io2_2025');

        // Show status message
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status show ${type}`;
            setTimeout(() => status.classList.remove('show'), 3000);
        }

        // Tab switching
        window.showTab = function(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-panel`).classList.add('active');
        };

        // Display player list
        function displayPlayers() {
            const playerList = document.getElementById('playerList');
            playerList.innerHTML = players.map(player => `
                <div class="player-item">
                    <img class="player-avatar" src="../assets/finals/finalists/${player}.png" 
                         onerror="this.src='../assets/finals/angelbubu-1.png'">
                    <span>@${player}</span>
                </div>
            `).join('');
        }

        // Initialize tournament
        window.initializeTournament = async function() {
            const shuffled = [...players].sort(() => Math.random() - 0.5);
            
            // Create matches
            const matches = {
                round1: [],
                round2: [],
                semifinals: [],
                finals: null
            };
            
            // Round 1: 7 matches
            for (let i = 0; i < 14; i += 2) {
                matches.round1.push({
                    id: `r1_${i/2}`,
                    player1: shuffled[i],
                    player2: shuffled[i + 1],
                    winner: null
                });
            }
            
            // Round 2: 4 matches (placeholders)
            for (let i = 0; i < 4; i++) {
                matches.round2.push({
                    id: `r2_${i}`,
                    player1: null,
                    player2: null,
                    winner: null
                });
            }
            
            // Semifinals: 2 matches (placeholders)
            for (let i = 0; i < 2; i++) {
                matches.semifinals.push({
                    id: `sf_${i}`,
                    player1: null,
                    player2: null,
                    winner: null
                });
            }
            
            // Finals: 1 match (placeholder)
            matches.finals = {
                id: 'finals',
                player1: null,
                player2: null,
                winner: null
            };
            
            // Save to Firebase
            await setDoc(tournamentRef, {
                matches,
                champion: null,
                createdAt: new Date().toISOString()
            });
            
            showStatus('Tournament initialized with random matchups!');
        };

        // Reset tournament
        window.resetTournament = async function() {
            if (!confirm('Reset the entire tournament?')) return;
            
            await setDoc(tournamentRef, {
                matches: null,
                champion: null
            });
            
            showStatus('Tournament reset!');
        };

        // Set match winner
        window.setWinner = async function(round, matchIndex, winner) {
            // Update winner in current match
            tournamentData.matches[round][matchIndex].winner = winner;
            
            // Advance winner to next round
            if (round === 'round1') {
                // Round 1 winners go to Round 2
                const nextMatchIndex = Math.floor(matchIndex / 2);
                const isPlayer1 = matchIndex % 2 === 0;
                
                if (isPlayer1) {
                    tournamentData.matches.round2[nextMatchIndex].player1 = winner;
                } else {
                    tournamentData.matches.round2[nextMatchIndex].player2 = winner;
                }
            } else if (round === 'round2') {
                // Round 2 winners go to Semifinals
                const nextMatchIndex = Math.floor(matchIndex / 2);
                const isPlayer1 = matchIndex % 2 === 0;
                
                if (isPlayer1) {
                    tournamentData.matches.semifinals[nextMatchIndex].player1 = winner;
                } else {
                    tournamentData.matches.semifinals[nextMatchIndex].player2 = winner;
                }
            } else if (round === 'semifinals') {
                // Semifinal winners go to Finals
                if (matchIndex === 0) {
                    tournamentData.matches.finals.player1 = winner;
                } else {
                    tournamentData.matches.finals.player2 = winner;
                }
            } else if (round === 'finals') {
                // Finals winner is champion
                tournamentData.champion = winner;
            }
            
            // Save to Firebase
            await setDoc(tournamentRef, tournamentData);
            showStatus(`${winner} wins!`);
        };

        // Render match management
        function renderMatchManagement() {
            if (!tournamentData || !tournamentData.matches) {
                document.getElementById('matchManagement').innerHTML = `
                    <p style="text-align: center; padding: 50px; color: #666;">
                        Initialize the tournament first to manage matches.
                    </p>
                `;
                return;
            }
            
            const container = document.getElementById('matchManagement');
            let html = '';
            
            // Render each round
            const rounds = [
                { name: 'Round 1', key: 'round1' },
                { name: 'Round 2', key: 'round2' },
                { name: 'Semifinals', key: 'semifinals' }
            ];
            
            rounds.forEach(({ name, key }) => {
                html += `<div class="round-section">`;
                html += `<div class="round-header">${name}</div>`;
                
                tournamentData.matches[key].forEach((match, index) => {
                    const canPlay = match.player1 && match.player2;
                    const isComplete = match.winner !== null;
                    
                    html += `<div class="match ${canPlay && !isComplete ? 'active' : ''}">`;
                    html += `<div class="match-players">`;
                    
                    // Player 1
                    html += `<div class="player-box ${match.winner === match.player1 ? 'winner' : ''}" 
                             ${canPlay && !isComplete ? `onclick="setWinner('${key}', ${index}, '${match.player1}')"` : ''}>
                             ${match.player1 || 'TBD'}
                         </div>`;
                    
                    html += `<div class="vs">VS</div>`;
                    
                    // Player 2
                    html += `<div class="player-box ${match.winner === match.player2 ? 'winner' : ''}"
                             ${canPlay && !isComplete ? `onclick="setWinner('${key}', ${index}, '${match.player2}')"` : ''}>
                             ${match.player2 || 'TBD'}
                         </div>`;
                    
                    html += `</div>`;
                    
                    if (canPlay && !isComplete) {
                        html += `<p style="text-align: center; color: #666; font-size: 12px;">Click on the winner</p>`;
                    }
                    
                    html += `</div>`;
                });
                
                html += `</div>`;
            });
            
            // Finals
            if (tournamentData.matches.finals) {
                const finals = tournamentData.matches.finals;
                const canPlay = finals.player1 && finals.player2;
                const isComplete = finals.winner !== null;
                
                html += `<div class="round-section">`;
                html += `<div class="round-header">FINALS</div>`;
                html += `<div class="match ${canPlay && !isComplete ? 'active' : ''}">`;
                html += `<div class="match-players">`;
                
                html += `<div class="player-box ${finals.winner === finals.player1 ? 'winner' : ''}"
                         ${canPlay && !isComplete ? `onclick="setWinner('finals', 0, '${finals.player1}')"` : ''}>
                         ${finals.player1 || 'TBD'}
                     </div>`;
                
                html += `<div class="vs">VS</div>`;
                
                html += `<div class="player-box ${finals.winner === finals.player2 ? 'winner' : ''}"
                         ${canPlay && !isComplete ? `onclick="setWinner('finals', 0, '${finals.player2}')"` : ''}>
                         ${finals.player2 || 'TBD'}
                     </div>`;
                
                html += `</div>`;
                
                if (canPlay && !isComplete) {
                    html += `<p style="text-align: center; color: #666; font-size: 12px;">Click on the winner</p>`;
                }
                
                html += `</div></div>`;
            }
            
            // Champion
            if (tournamentData.champion) {
                html += `<div class="champion-display">`;
                html += `<h2>üèÜ CHAMPION üèÜ</h2>`;
                html += `<img class="champion-avatar" src="../assets/finals/finalists/${tournamentData.champion}.png" 
                         onerror="this.src='../assets/finals/angelbubu-1.png'">`;
                html += `<h3>@${tournamentData.champion}</h3>`;
                html += `</div>`;
            }
            
            container.innerHTML = html;
        }

        // Render bracket view
        function renderBracketView() {
            if (!tournamentData || !tournamentData.matches) {
                document.getElementById('bracketView').innerHTML = `
                    <p style="text-align: center; padding: 50px; color: #666;">
                        Initialize the tournament first to view the bracket.
                    </p>
                `;
                return;
            }
            
            const container = document.getElementById('bracketView');
            let html = '<div class="bracket-view">';
            
            // Round 1
            html += '<div class="bracket-round">';
            html += '<h3 style="color: white; text-align: center; margin-bottom: 20px;">ROUND 1</h3>';
            tournamentData.matches.round1.forEach(match => {
                html += renderBracketMatch(match);
            });
            html += '</div>';
            
            // Round 2
            html += '<div class="bracket-round">';
            html += '<h3 style="color: white; text-align: center; margin-bottom: 20px;">ROUND 2</h3>';
            tournamentData.matches.round2.forEach(match => {
                html += renderBracketMatch(match);
            });
            html += '</div>';
            
            // Semifinals
            html += '<div class="bracket-round">';
            html += '<h3 style="color: white; text-align: center; margin-bottom: 20px;">SEMIFINALS</h3>';
            tournamentData.matches.semifinals.forEach(match => {
                html += renderBracketMatch(match);
            });
            html += '</div>';
            
            // Finals
            html += '<div class="bracket-round">';
            html += '<h3 style="color: white; text-align: center; margin-bottom: 20px;">FINALS</h3>';
            html += renderBracketMatch(tournamentData.matches.finals);
            html += '</div>';
            
            // Champion
            if (tournamentData.champion) {
                html += '<div class="bracket-round">';
                html += '<h3 style="color: white; text-align: center; margin-bottom: 20px;">CHAMPION</h3>';
                html += `<div class="champion-display" style="background: gold;">`;
                html += `<h2>üëë</h2>`;
                html += `<h3>@${tournamentData.champion}</h3>`;
                html += `</div>`;
                html += '</div>';
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function renderBracketMatch(match) {
            if (!match) return '';
            
            let html = '<div class="bracket-match">';
            
            // Player 1
            let p1Class = '';
            if (match.winner) {
                p1Class = match.winner === match.player1 ? 'winner' : 'loser';
            }
            html += `<div class="bracket-player ${p1Class}">`;
            html += match.player1 ? `@${match.player1}` : 'TBD';
            html += `</div>`;
            
            // Player 2
            let p2Class = '';
            if (match.winner) {
                p2Class = match.winner === match.player2 ? 'winner' : 'loser';
            }
            html += `<div class="bracket-player ${p2Class}">`;
            html += match.player2 ? `@${match.player2}` : 'TBD';
            html += `</div>`;
            
            html += '</div>';
            return html;
        }

        // Listen for tournament updates
        const unsubscribe = onSnapshot(tournamentRef, (doc) => {
            if (doc.exists()) {
                tournamentData = doc.data();
                renderMatchManagement();
                renderBracketView();
            }
        });

        // Initialize
        displayPlayers();
        
        // Cleanup
        window.addEventListener('beforeunload', () => {
            if (unsubscribe) unsubscribe();
        });
    </script>
</body>
</html>