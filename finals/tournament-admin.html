<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTERNET OLYMPICS 2 - Tournament Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #008080 url('../assets/finals/desktop-bg.jpg') center/cover;
            min-height: 100vh;
            padding: 20px;
        }

        /* Windows XP style windows */
        .window {
            background: #ece9d8;
            border: 2px solid #0054e3;
            border-radius: 6px 6px 0 0;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .window-header {
            background: linear-gradient(to bottom, #0054e3, #0041d0);
            color: white;
            padding: 3px 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 4px 4px 0 0;
        }

        .window-title {
            font-size: 13px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .window-controls {
            display: flex;
            gap: 2px;
        }

        .window-btn {
            width: 21px;
            height: 21px;
            border: 1px solid #fff;
            background: linear-gradient(to bottom, #fff, #e0e0e0);
            color: #000;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2px;
        }

        .window-content {
            padding: 15px;
            background: #fff;
            border: 1px solid #8b8b8b;
            margin: 3px;
        }

        /* Tournament section */
        .tournament-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #000080;
            text-transform: uppercase;
        }

        /* Match management */
        .round-container {
            margin-bottom: 20px;
        }

        .round-header {
            background: #000080;
            color: white;
            padding: 8px;
            font-weight: bold;
            font-size: 14px;
        }

        .match-item {
            background: #f0f0f0;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }

        .match-players {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 5px;
            flex: 1;
            padding: 5px;
            background: #fff;
            border: 1px solid #999;
        }

        .player-info.winner {
            background: #90ee90;
            font-weight: bold;
        }

        .player-avatar {
            width: 30px;
            height: 30px;
            object-fit: cover;
            border: 1px solid #000;
        }

        .vs-text {
            font-weight: bold;
            padding: 0 10px;
        }

        .match-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            background: #ece9d8;
            border: 2px solid #c0c0c0;
            border-bottom: 2px solid #808080;
            border-right: 2px solid #808080;
            padding: 5px 15px;
            font-family: Arial, sans-serif;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.1s;
        }

        .btn:hover {
            background: #e0e0e0;
        }

        .btn:active {
            border: 2px solid #808080;
            border-bottom: 2px solid #c0c0c0;
            border-right: 2px solid #c0c0c0;
        }

        .btn.primary {
            background: #4CAF50;
            color: white;
        }

        .btn.danger {
            background: #ff6666;
            color: white;
        }

        /* Status indicator */
        .match-status {
            display: inline-block;
            padding: 2px 8px;
            font-size: 11px;
            font-weight: bold;
            border-radius: 3px;
            text-transform: uppercase;
        }

        .match-status.pending {
            background: #fffacd;
            color: #b8860b;
        }

        .match-status.active {
            background: #90ee90;
            color: #006400;
        }

        .match-status.completed {
            background: #d3d3d3;
            color: #555;
        }

        /* Game code input */
        .game-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }

        .game-input input {
            padding: 4px;
            border: 1px solid #999;
            font-family: monospace;
            text-transform: uppercase;
        }

        /* Champion section */
        .champion-section {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border: 3px solid #000;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
        }

        .champion-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Navigation */
        .nav-links {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .nav-link {
            background: #fff;
            border: 2px solid #000;
            padding: 10px 15px;
            text-decoration: none;
            color: #000;
            font-weight: bold;
            font-size: 12px;
            box-shadow: 2px 2px 0 rgba(0,0,0,0.5);
        }

        .nav-link:hover {
            background: #f0f0f0;
        }

        /* Placeholder select */
        select {
            padding: 4px;
            border: 1px solid #999;
        }
    </style>
</head>
<body>
    <div class="nav-links">
        <a href="bracket.html" class="nav-link">VIEW BRACKET</a>
        <a href="admin.html" class="nav-link">GAME ADMIN</a>
    </div>

    <div class="window">
        <div class="window-header">
            <div class="window-title">
                üèÜ TOURNAMENT ADMIN - Manage Bracket
            </div>
            <div class="window-controls">
                <button class="window-btn">_</button>
                <button class="window-btn">‚ñ°</button>
                <button class="window-btn">√ó</button>
            </div>
        </div>
        <div class="window-content">
            <div id="tournamentContainer">
                <div class="loading">Loading tournament data...</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getFirestore, 
            doc, 
            getDoc,
            updateDoc,
            onSnapshot
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDJ8uiR2qEUfXIuFEO2l-40668WNpQdj2w",
            authDomain: "c0uchz0mb13.firebaseapp.com",
            projectId: "c0uchz0mb13",
            storageBucket: "c0uchz0mb13.firebasestorage.app",
            messagingSenderId: "1051521591004",
            appId: "1:1051521591004:web:1301f129fc0f3032f6f619",
            measurementId: "G-6BNDYZQRPE"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentTournament = null;
        const tournamentRef = doc(db, 'tournament', 'finals2025');

        // Render tournament admin interface
        function renderTournamentAdmin(tournament) {
            const container = document.getElementById('tournamentContainer');
            
            container.innerHTML = `
                <div class="tournament-section">
                    <h2 class="section-title">Tournament Management</h2>
                    
                    <!-- Round 1 -->
                    <div class="round-container">
                        <div class="round-header">ROUND 1</div>
                        ${tournament.round1.map((match, i) => renderMatch(match, 'round1', i)).join('')}
                    </div>
                    
                    <!-- Round 2 -->
                    <div class="round-container">
                        <div class="round-header">ROUND 2</div>
                        ${tournament.round2.map((match, i) => renderMatch(match, 'round2', i)).join('')}
                    </div>
                    
                    <!-- Semifinals -->
                    <div class="round-container">
                        <div class="round-header">SEMIFINALS</div>
                        ${tournament.semifinals.map((match, i) => renderMatch(match, 'semifinals', i)).join('')}
                    </div>
                    
                    <!-- Finals -->
                    <div class="round-container">
                        <div class="round-header">FINALS</div>
                        ${renderMatch(tournament.finals, 'finals', 0)}
                    </div>
                    
                    <!-- Champion -->
                    <div class="champion-section">
                        <h3>üèÜ CHAMPION üèÜ</h3>
                        ${tournament.champion ? 
                            `<div style="font-size: 24px; margin: 10px 0;">@${tournament.champion}</div>` : 
                            '<div style="color: #666;">No champion yet</div>'
                        }
                        <div class="champion-controls">
                            ${tournament.finals.winner && !tournament.champion ? 
                                `<button class="btn primary" onclick="setChampion('${tournament.finals.winner}')">
                                    Crown ${tournament.finals.winner} as Champion
                                </button>` : ''
                            }
                            ${tournament.champion ? 
                                `<button class="btn danger" onclick="resetChampion()">
                                    Reset Champion
                                </button>` : ''
                            }
                        </div>
                    </div>
                </div>
            `;
        }

        // Render individual match
        function renderMatch(match, round, index) {
            const hasPlayers = match.player1 && match.player2;
            
            return `
                <div class="match-item">
                    <div class="match-status ${match.status}">${match.status}</div>
                    <div class="match-players">
                        ${match.player1 ? `
                            <div class="player-info ${match.winner === match.player1 ? 'winner' : ''}">
                                <img class="player-avatar" src="../assets/finals/finalists/${match.player1}.png" 
                                     onerror="this.src='../assets/finals/angelbubu-1.png'">
                                <span>@${match.player1}</span>
                            </div>
                        ` : '<div class="player-info">TBD</div>'}
                        
                        <span class="vs-text">VS</span>
                        
                        ${match.player2 ? `
                            <div class="player-info ${match.winner === match.player2 ? 'winner' : ''}">
                                <img class="player-avatar" src="../assets/finals/finalists/${match.player2}.png" 
                                     onerror="this.src='../assets/finals/angelbubu-2.png'">
                                <span>@${match.player2}</span>
                            </div>
                        ` : '<div class="player-info">TBD</div>'}
                    </div>
                    
                    <div class="match-controls">
                        ${hasPlayers && match.status === 'pending' ? `
                            <button class="btn" onclick="activateMatch('${round}', ${index})">
                                Activate Match
                            </button>
                        ` : ''}
                        
                        ${hasPlayers && (match.status === 'active' || match.status === 'completed') ? `
                            <button class="btn primary" onclick="setWinner('${round}', ${index}, '${match.player1}')">
                                ${match.player1} Wins
                            </button>
                            <button class="btn primary" onclick="setWinner('${round}', ${index}, '${match.player2}')">
                                ${match.player2} Wins
                            </button>
                        ` : ''}
                        
                        ${match.gameId ? `
                            <a href="spectator.html?game=${match.gameId}" class="btn">Watch Game</a>
                        ` : ''}
                        
                        ${match.status === 'active' ? `
                            <div class="game-input">
                                <input type="text" id="gameCode_${round}_${index}" placeholder="Game Code" maxlength="6">
                                <button class="btn" onclick="setGameCode('${round}', ${index})">
                                    Set Game Code
                                </button>
                            </div>
                        ` : ''}
                        
                        ${match.status === 'completed' ? `
                            <button class="btn danger" onclick="resetMatch('${round}', ${index})">
                                Reset Match
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Tournament management functions
        window.activateMatch = async function(round, index) {
            const update = {};
            update[`${round}.${index}.status`] = 'active';
            await updateDoc(tournamentRef, update);
        };

        window.setGameCode = async function(round, index) {
            const gameCode = document.getElementById(`gameCode_${round}_${index}`).value.trim().toUpperCase();
            if (!gameCode) return;
            
            const update = {};
            update[`${round}.${index}.gameId`] = gameCode;
            await updateDoc(tournamentRef, update);
        };

        window.setWinner = async function(round, index, winner) {
            if (!confirm(`Set ${winner} as the winner?`)) return;
            
            const match = currentTournament[round][index];
            const update = {};
            update[`${round}.${index}.winner`] = winner;
            update[`${round}.${index}.status`] = 'completed';
            
            // Advance winner to next round
            if (round === 'round1') {
                // Determine which round2 match
                const nextMatchIndex = Math.floor(index / 2);
                const isPlayer1 = index % 2 === 0;
                update[`round2.${nextMatchIndex}.${isPlayer1 ? 'player1' : 'player2'}`] = winner;
            } else if (round === 'round2') {
                // Determine which semifinal match
                const nextMatchIndex = Math.floor(index / 2);
                const isPlayer1 = index % 2 === 0;
                update[`semifinals.${nextMatchIndex}.${isPlayer1 ? 'player1' : 'player2'}`] = winner;
            } else if (round === 'semifinals') {
                // Advance to finals
                const isPlayer1 = index === 0;
                update[`finals.${isPlayer1 ? 'player1' : 'player2'}`] = winner;
            }
            
            await updateDoc(tournamentRef, update);
        };

        window.resetMatch = async function(round, index) {
            if (!confirm('Reset this match? This will clear the winner.')) return;
            
            const update = {};
            update[`${round}.${index}.winner`] = null;
            update[`${round}.${index}.status`] = 'pending';
            update[`${round}.${index}.gameId`] = null;
            
            await updateDoc(tournamentRef, update);
        };

        window.setChampion = async function(champion) {
            if (!confirm(`Crown ${champion} as the tournament champion?`)) return;
            
            await updateDoc(tournamentRef, {
                champion: champion
            });
        };

        window.resetChampion = async function() {
            if (!confirm('Reset the champion?')) return;
            
            await updateDoc(tournamentRef, {
                champion: null
            });
        };

        // Subscribe to tournament updates
        const unsubscribe = onSnapshot(tournamentRef, (doc) => {
            if (doc.exists()) {
                currentTournament = doc.data();
                renderTournamentAdmin(currentTournament);
            }
        });

        // Cleanup
        window.addEventListener('beforeunload', () => {
            if (unsubscribe) unsubscribe();
        });
    </script>
</body>
</html>