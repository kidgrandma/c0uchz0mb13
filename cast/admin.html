<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN PANEL ☠️ INTERNET OLYMPICS 2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #0a0a0a;
            color: #00ff00;
            min-height: 100vh;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    rgba(0, 255, 0, 0.03) 0px,
                    transparent 1px,
                    transparent 2px,
                    rgba(0, 255, 0, 0.03) 3px
                );
            animation: scanlines 8s linear infinite;
            overflow-x: hidden;
        }

        @keyframes scanlines {
            0% { background-position: 0 0; }
            100% { background-position: 0 10px; }
        }

        /* Glitch effect */
        @keyframes glitch {
            0%, 100% { 
                text-shadow: 
                    2px 0 #ff00ff,
                    -2px 0 #00ffff,
                    0 0 10px #00ff00;
            }
            25% { 
                text-shadow: 
                    -2px 0 #ff00ff,
                    2px 0 #00ffff,
                    0 0 10px #ff00ff;
            }
            50% { 
                text-shadow: 
                    2px 0 #00ffff,
                    -2px 0 #ff00ff,
                    0 0 10px #00ffff;
            }
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #ff00ff 0%, #00ffff 50%, #ffff00 100%);
            padding: 2px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header-inner {
            background: #0a0a0a;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-family: 'Times New Roman', Times, serif;
            font-size: 48px;
            letter-spacing: 4px;
            animation: glitch 2s infinite;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #ff00ff;
            font-size: 20px;
            letter-spacing: 8px;
            text-transform: uppercase;
        }

        /* Login Screen */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: #1a1a1a;
            border: 2px solid #00ff00;
            padding: 40px;
            position: relative;
            box-shadow: 
                0 0 20px #00ff00,
                inset 0 0 20px rgba(0, 255, 0, 0.1);
        }

        .login-container::before {
            content: "ACCESS RESTRICTED";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff0000;
            color: #000;
            padding: 5px 20px;
            font-size: 14px;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            background: #000;
            border: 1px solid #00ff00;
            color: #00ff00;
            font-family: Arial, sans-serif;
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 2px;
        }

        .login-input::placeholder {
            color: #006600;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: #00ff00;
            color: #000;
            border: none;
            font-family: Arial, sans-serif;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 4px;
            transition: all 0.3s;
        }

        .login-btn:hover {
            background: #ff00ff;
            box-shadow: 0 0 20px #ff00ff;
        }

        .error-msg {
            color: #ff0000;
            text-align: center;
            margin-top: 20px;
            font-size: 18px;
            display: none;
            animation: blink 0.5s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Admin Panel Container */
        .admin-panel {
            display: none;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Logout Button */
        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff0000;
            color: #fff;
            border: 2px solid #fff;
            padding: 10px 20px;
            font-family: 'VT323', monospace;
            font-size: 20px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            z-index: 1000;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #fff;
            color: #ff0000;
            transform: scale(1.1);
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 2px;
            margin-bottom: 30px;
            background: #333;
            padding: 2px;
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            background: #1a1a1a;
            color: #00ff00;
            border: none;
            font-family: 'VT323', monospace;
            font-size: 20px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab-btn:hover {
            background: #2a2a2a;
        }

        .tab-btn.active {
            background: #00ff00;
            color: #000;
            font-weight: bold;
            box-shadow: 0 0 20px #00ff00;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Section Styling */
        .section {
            background: #1a1a1a;
            border: 2px solid #00ff00;
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
        }

        .section::before {
            content: "";
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ffff00, #ff00ff);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .section:hover::before {
            opacity: 1;
        }

        .section-title {
            font-size: 32px;
            color: #ff00ff;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 4px;
            text-shadow: 2px 2px #000;
        }

        /* Form Styling */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            color: #00ffff;
            font-size: 18px;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .form-input, .form-select, .form-textarea {
            padding: 12px;
            background: #000;
            border: 1px solid #00ff00;
            color: #00ff00;
            font-family: 'VT323', monospace;
            font-size: 20px;
            transition: all 0.3s;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: Arial, sans-serif;
            font-size: 16px;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #ff00ff;
            box-shadow: 0 0 10px #ff00ff;
        }

        /* Tools Grid - Updated */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .tool-item {
            background: #2a2a2a;
            border: 1px solid #00ff00;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .tool-item:hover {
            background: #3a3a3a;
            transform: scale(1.05);
        }

        .tool-item.selected {
            background: #00ff00;
            border-color: #fff;
            box-shadow: 0 0 10px #00ff00;
        }

        .tool-item.selected label,
        .tool-item.selected .tool-price {
            color: #000;
            font-weight: bold;
        }

        .tool-icon-preview {
            width: 80px;
            height: 80px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tool-icon-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .tool-name-display {
            font-size: 16px;
            color: #00ffff;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .tool-price {
            display: block;
            margin-top: 5px;
            color: #ffff00;
            font-size: 18px;
        }

        .tool-description-preview {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
            font-style: italic;
        }

        /* User Table */
        .users-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 18px;
            overflow-x: auto;
            display: block;
        }

        .users-table thead {
            background: #2a2a2a;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .users-table th {
            padding: 15px 10px;
            text-align: left;
            color: #ff00ff;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 2px solid #00ff00;
            white-space: nowrap;
        }

        .users-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #333;
            white-space: nowrap;
        }

        .users-table tr:hover {
            background: rgba(0, 255, 0, 0.1);
        }

        /* Status Colors */
        .status-active { color: #00ff00; }
        .status-blocked { color: #ff0000; }
        .status-dead { color: #666; text-decoration: line-through; }

        /* Action Buttons */
        .action-btn {
            padding: 8px 15px;
            margin: 0 2px;
            background: #00ff00;
            color: #000;
            border: none;
            font-family: 'VT323', monospace;
            font-size: 16px;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: #ff00ff;
            transform: scale(1.1);
        }

        .action-btn.danger {
            background: #ff0000;
            color: #fff;
        }

        .action-btn.danger:hover {
            background: #cc0000;
        }

        /* Submit Button */
        .submit-btn {
            background: #ff00ff;
            color: #000;
            border: 2px solid #fff;
            padding: 15px 40px;
            font-family: 'VT323', monospace;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 4px;
            display: block;
            margin: 30px auto 0;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: #00ffff;
            transform: scale(1.05);
            box-shadow: 0 0 30px #00ffff;
        }

        /* Messages */
        .message {
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 20px;
            letter-spacing: 2px;
            text-transform: uppercase;
            animation: fadeIn 0.5s;
        }

        .message.success {
            background: #00ff00;
            color: #000;
            border: 2px solid #fff;
        }

        .message.error {
            background: #ff0000;
            color: #fff;
            border: 2px solid #fff;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #2a2a2a;
            border: 2px solid #00ff00;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.3), transparent);
            transition: left 0.5s;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-number {
            font-size: 48px;
            color: #ffff00;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 18px;
            color: #00ffff;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Tools Display with Icons */
        .tools-display {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .tool-tag {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #00ff00;
            color: #000;
            padding: 5px 10px;
            font-size: 14px;
            font-weight: bold;
            position: relative;
            cursor: pointer;
        }

        .tool-tag.used {
            background: #666;
            text-decoration: line-through;
        }

        .tool-tag img {
            width: 20px;
            height: 20px;
            object-fit: contain;
        }

        /* Tool Management Table */
        .tools-management-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .tools-management-table th {
            background: #2a2a2a;
            padding: 15px;
            text-align: left;
            color: #ff00ff;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 2px solid #00ff00;
        }

        .tools-management-table td {
            padding: 15px;
            border-bottom: 1px solid #333;
        }

        .tools-management-table tr:hover {
            background: rgba(0, 255, 0, 0.1);
        }

        .tool-icon-cell {
            width: 60px;
        }

        .tool-icon-cell img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 32px;
            }
            
            .tab-nav {
                flex-wrap: nowrap;
                overflow-x: scroll;
                -webkit-overflow-scrolling: touch;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .users-table {
                font-size: 14px;
            }
            
            .users-table th,
            .users-table td {
                padding: 8px 5px;
            }
            
            .logout-btn {
                position: fixed;
                bottom: 20px;
                right: 20px;
                top: auto;
            }
            
            .tools-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
        }

        /* Edit Modal */
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .edit-modal.active {
            display: flex;
        }

        .edit-modal-content {
            background: #1a1a1a;
            border: 2px solid #00ff00;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 30px #00ff00;
        }

        .edit-modal-header {
            font-size: 24px;
            color: #ff00ff;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .close-edit-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff0000;
            color: #fff;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .close-edit-modal:hover {
            background: #cc0000;
        }
        /* Loading Animation */
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 24px;
            color: #00ff00;
        }

        .loading::after {
            content: "...";
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60%, 100% { content: "..."; }
        }
    </style>
</head>
<body>
    <!-- Edit User Modal -->
    <div class="edit-modal" id="editModal">
        <div class="edit-modal-content">
            <button class="close-edit-modal" onclick="closeEditModal()">✖</button>
            <h2 class="edit-modal-header">📝 EDIT USER</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Access Code</label>
                    <input type="text" class="form-input" id="editAccessCode" disabled style="opacity: 0.6;">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Handle/Username</label>
                    <input type="text" class="form-input" id="editHandle">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="editEmail">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-select" id="editStatus">
                        <option value="active">ACTIVE</option>
                        <option value="blocked">BLOCKED</option>
                        <option value="dead">DEAD</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Change Character</label>
                    <select class="form-select" id="editCharacter">
                        <option value="">-- NO CHARACTER --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Team</label>
                    <select class="form-select" id="editTeam">
                        <option value="">UNASSIGNED</option>
                        <option value="cable">TEAM CABLE GUY</option>
                        <option value="milk">TEAM MILK</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Payment Amount</label>
                    <input type="number" class="form-input" id="editPaymentAmount" step="0.01">
                </div>
                
                <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="editPaid" style="width: auto;">
                    <label class="form-label" for="editPaid" style="margin: 0;">Payment Verified</label>
                </div>
                <div class="form-group">
                      <label class="form-label">Send Note to User</label>
                      <input type="text" 
                            class="form-input"  
                            id="editUserNote" 
                            placeholder="Type a note/message for this user (optional)">
</div>
            </div>
            
            <button class="submit-btn" onclick="saveUserEdit()">SAVE CHANGES 💾</button>
            <div id="editUserMessage"></div>
        </div>
    </div>
    <!-- Login Screen -->
    <div class="login-container" id="loginContainer">
        <h2 style="text-align: center; font-size: 32px; margin-bottom: 30px; color: #ff00ff;">ADMIN ACCESS</h2>
        <input type="password" 
               class="login-input" 
               id="adminPassword" 
               placeholder="ENTER PASSWORD"
               autocomplete="off">
        <button class="login-btn" onclick="loginAdmin()">ACCESS SYSTEM</button>
        <div class="error-msg" id="loginError">ACCESS DENIED</div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <button class="logout-btn" onclick="logoutAdmin()">LOGOUT ☠️</button>
        
        <div class="header">
            <div class="header-inner">
                <h1>🎮 INTERNET OLYMPICS 2 🎮</h1>
                <p class="subtitle">ADMIN CONTROL PANEL</p>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('dashboard')">DASHBOARD</button>
            <button class="tab-btn" onclick="switchTab('create-user')">CREATE USER</button>
            <button class="tab-btn" onclick="switchTab('manage-users')">MANAGE USERS</button>
            <button class="tab-btn" onclick="switchTab('characters')">CHARACTERS</button>
            <button class="tab-btn" onclick="switchTab('teams')">TEAMS</button>
            <button class="tab-btn" onclick="switchTab('tools')">TOOLS</button>
            <button class="tab-btn" onclick="switchTab('pending')">PENDING</button>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard-tab">
            <div class="section">
                <h2 class="section-title">📊 SYSTEM STATS</h2>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeUsers">0</div>
                        <div class="stat-label">Active Players</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="charactersUsed">0</div>
                        <div class="stat-label">Characters Taken</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalRevenue">$0</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">⚡ RECENT ACTIVITY</h2>
                <div id="recentActivity" class="loading">Loading activity</div>
            </div>
        </div>

        <!-- Create User Tab -->
        <div class="tab-content" id="create-user-tab">
            <div class="section">
                <h2 class="section-title">🆕 CREATE NEW USER</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Access Code*</label>
                        <input type="text" 
                               class="form-input" 
                               id="newAccessCode" 
                               placeholder="PLAYER001"
                               style="text-transform: uppercase;">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Handle/Username*</label>
                        <input type="text" 
                               class="form-input" 
                               id="newHandle" 
                               placeholder="xX_player_Xx">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" 
                               class="form-input" 
                               id="newEmail" 
                               placeholder="player@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Character</label>
                        <select class="form-select" id="newCharacter">
                            <option value="">-- NO CHARACTER --</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Team</label>
                        <select class="form-select" id="newTeam">
                            <option value="">UNASSIGNED</option>
                            <option value="cable">TEAM CABLE GUY</option>
                            <option value="milk">TEAM MILK</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Initial Points</label>
                        <input type="number" 
                               class="form-input" 
                               id="newPoints" 
                               value="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Payment Amount</label>
                        <input type="number" 
                               class="form-input" 
                               id="newPaymentAmount" 
                               value="0"
                               step="0.01">
                    </div>
                    
                    <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="newPaid" style="width: auto;">
                        <label class="form-label" for="newPaid" style="margin: 0;">Payment Verified</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Select Tools</label>
                    <div class="tools-grid" id="toolsGrid">
                        <!-- Tools will be populated here -->
                    </div>
                </div>
                
                <button class="submit-btn" onclick="createNewUser()">CREATE USER 💀</button>
                
                <div id="createUserMessage"></div>
            </div>
        </div>

        <!-- Manage Users Tab -->
        <div class="tab-content" id="manage-users-tab">
            <div class="section">
                <h2 class="section-title">👥 ALL USERS</h2>
                <div style="overflow-x: auto;">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>CODE</th>
                                <th>HANDLE</th>
                                <th>CHARACTER</th>
                                <th>STATUS</th>
                                <th>TEAM</th>
                                <th>IND PTS</th>
                                <th>PAID</th>
                                <th>AMOUNT</th>
                                <th>CREDIT</th>
                                <th>TOOLS</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr><td colspan="10" class="loading">Loading users</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Characters Tab -->
        <div class="tab-content" id="characters-tab">
            <div class="section">
                <h2 class="section-title">🎭 CHARACTER STATUS</h2>
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-number" id="availableChars">0</div>
                        <div class="stat-label">Available</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="takenChars">0</div>
                        <div class="stat-label">Taken</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalChars">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                </div>
                
                <div class="character-grid" id="characterGrid">
                    <div class="loading">Loading characters</div>
                </div>
            </div>
        </div>

        <!-- Teams Tab -->
        <div class="tab-content" id="teams-tab">
            <div class="section">
                <h2 class="section-title">🏆 TEAM STANDINGS</h2>
                <div id="teamStandings" class="loading">Loading teams</div>
            </div>
        </div>

        <!-- Tools Tab - Enhanced -->
        <div class="tab-content" id="tools-tab">
            <div class="section">
                <h2 class="section-title">🔧 ADD NEW TOOL</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Tool Name*</label>
                        <input type="text" 
                               class="form-input" 
                               id="newToolName" 
                               placeholder="LABUBU VOODOO">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Price* (no $ sign)</label>
                        <input type="number" 
                               class="form-input" 
                               id="newToolPrice" 
                               placeholder="100"
                               min="1">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Icon Filename</label>
                        <input type="text" 
                               class="form-input" 
                               id="newToolIcon" 
                               placeholder="labubu-voodoo.png">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description (Optional)</label>
                    <textarea class="form-textarea" 
                              id="newToolDescription" 
                              placeholder="Resurrection card - bring a dead player back to life"></textarea>
                </div>
                
                <button class="submit-btn" onclick="addNewTool()">ADD TOOL 🔨</button>
                
                <div id="addToolMessage"></div>
            </div>
            
            <div class="section">
                <h2 class="section-title">⚡ MANAGE TOOLS</h2>
                <div id="toolsList" class="loading">Loading tools</div>
            </div>
        </div>

        <!-- Pending Selections Tab -->
        <div class="tab-content" id="pending-tab">
            <div class="section">
                <h2 class="section-title">⏳ PENDING SELECTIONS</h2>
                <div id="pendingList" class="loading">Loading pending selections</div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { 
            getFirestore, 
            collection, 
            getDocs, 
            doc, 
            getDoc,
            updateDoc, 
            deleteDoc,
            setDoc,
            addDoc,
            onSnapshot,
            query,
            where,
            orderBy,
            limit
        } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDJ8uiR2qEUfXIuFEO21-40668WNpOdj2w",
            authDomain: "c0uchz0mb13.firebaseapp.com",
            projectId: "c0uchz0mb13",
            storageBucket: "c0uchz0mb13.firebasestorage.app",
            messagingSenderId: "1051521591004",
            appId: "1:1051521591004:web:1301f129fc0f3032f6f619",
            measurementId: "G-6BNDYZQRPE"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Admin password - CHANGE THIS!
        const ADMIN_PASSWORD = 'olympics2024';

        // Global state
        window.currentTab = 'dashboard';
        window.allCharacters = [];
        window.allUsers = [];
        window.allTools = [];

        // Tool icon mapping
        const toolIconMap = {
            'LABUBU VOODOO': 'labubu-voodoo.png',
            'KOOL-AID KILLA': 'kool-aid-life.png',
            'MY GIRL\'S GLASSES': 'glasses.png',
            'UR SO H4CK3D': 'anonymous.png'
        };

        // Initialize default tools if needed
        async function initializeDefaultTools() {
            const toolsSnapshot = await getDocs(collection(db, 'tools'));
            
            if (toolsSnapshot.empty) {
                const defaultTools = [
                    { 
                        name: 'LABUBU VOODOO', 
                        price: 100, 
                        icon: 'labubu-voodoo.png',
                        description: 'Resurrection card - bring a dead player back to life'
                    },
                    { 
                        name: 'KOOL-AID KILLA', 
                        price: 50, 
                        icon: 'kool-aid-life.png',
                        description: 'Steal points from another player'
                    },
                    { 
                        name: 'MY GIRL\'S GLASSES', 
                        price: 100, 
                        icon: 'glasses.png',
                        description: 'Preview future challenge cards'
                    },
                    { 
                        name: 'UR SO H4CK3D', 
                        price: 150, 
                        icon: 'anonymous.png',
                        description: 'Skip or auto-win a challenge'
                    }
                ];
                
                for (const tool of defaultTools) {
                    await addDoc(collection(db, 'tools'), tool);
                }
                
                console.log('Default tools initialized');
            }
        }

        // Login function
        window.loginAdmin = function() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                localStorage.setItem('adminLoggedIn', 'true');
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                initializeAdmin();
            } else {
                document.getElementById('loginError').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('loginError').style.display = 'none';
                }, 3000);
            }
        };

        // Logout function
        window.logoutAdmin = function() {
            if (confirm('Really logout? 🤔')) {
                localStorage.removeItem('adminLoggedIn');
                location.reload();
            }
        };

        // Check if already logged in
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                initializeAdmin();
            }

            // Enter key for login
            document.getElementById('adminPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    loginAdmin();
                }
            });
        });

        // Initialize admin panel
        async function initializeAdmin() {
            await initializeDefaultTools();
            loadDashboard();
            loadCharactersForDropdown();
            await loadToolsFromFirebase();
            loadToolsGrid();
            setupRealtimeListeners();
        }

        // Tab switching
        window.switchTab = function(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Mark button as active
            event.target.classList.add('active');
            
            // Load tab data
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'manage-users':
                    loadUsers();
                    break;
                case 'characters':
                    loadCharacters();
                    break;
                case 'teams':
                    loadTeams();
                    break;
                case 'tools':
                    loadToolsTab();
                    break;
                case 'pending':
                    loadPendingSelections();
                    break;
            }
        };

        // Load dashboard stats
        async function loadDashboard() {
            try {
                const usersSnapshot = await getDocs(collection(db, 'users'));
                const charactersSnapshot = await getDocs(collection(db, 'characters'));
                
                let activeCount = 0;
                let totalRevenue = 0;
                let recentUsers = [];
                
                usersSnapshot.forEach(doc => {
                    const user = doc.data();
                    if (user.status === 'active') activeCount++;
                    if (user.paymentAmount) totalRevenue += parseFloat(user.paymentAmount);
                    
                    recentUsers.push({
                        code: doc.id,
                        ...user,
                        timestamp: user.createdAt || new Date().toISOString()
                    });
                });
                
                let charactersUsed = 0;
                charactersSnapshot.forEach(doc => {
                    if (!doc.data().available) charactersUsed++;
                });
                
                // Update stats
                document.getElementById('totalUsers').textContent = usersSnapshot.size;
                document.getElementById('activeUsers').textContent = activeCount;
                document.getElementById('charactersUsed').textContent = charactersUsed;
                document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
                
                // Show recent activity
                const activityDiv = document.getElementById('recentActivity');
                if (recentUsers.length === 0) {
                    activityDiv.innerHTML = '<p style="text-align: center; color: #666;">No activity yet</p>';
                } else {
                    // Sort by timestamp and take last 5
                    recentUsers.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    const recentFive = recentUsers.slice(0, 5);
                    
                    activityDiv.innerHTML = recentFive.map(user => `
                        <div style="padding: 10px; border-bottom: 1px solid #333;">
                            <span style="color: #ff00ff;">${user.code}</span> - 
                            <span style="color: #00ffff;">${user.handle || 'No handle'}</span>
                            ${user.characterName ? `<span style="color: #ffff00;"> → ${user.characterName}</span>` : ''}
                            <span style="float: right; color: #666; font-size: 16px;">
                                ${new Date(user.timestamp).toLocaleDateString()}
                            </span>
                        </div>
                    `).join('');
                }
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Load characters for dropdown
        async function loadCharactersForDropdown() {
            try {
                const snapshot = await getDocs(collection(db, 'characters'));
                const select = document.getElementById('newCharacter');
                select.innerHTML = '<option value="">-- NO CHARACTER --</option>';
                
                window.allCharacters = [];
                
                snapshot.forEach((doc) => {
                    const character = { id: doc.id, ...doc.data() };
                    window.allCharacters.push(character);
                    
                    const option = document.createElement('option');
                    option.value = doc.id;
                    
                    if (character.available) {
                        option.textContent = `${character.name} (${character.show})`;
                    } else {
                        option.textContent = `${character.name} (TAKEN by ${character.ownerId || 'Unknown'})`;
                        option.disabled = true;
                        option.style.color = '#666';
                    }
                    
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading characters:', error);
            }
        }

        // Load tools from Firebase
        async function loadToolsFromFirebase() {
            try {
                const snapshot = await getDocs(collection(db, 'tools'));
                window.allTools = [];
                
                snapshot.forEach(doc => {
                    window.allTools.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                // Sort by price
                window.allTools.sort((a, b) => a.price - b.price);
                
            } catch (error) {
                console.error('Error loading tools:', error);
            }
        }

        // Load tools grid with icons
        function loadToolsGrid() {
            const toolsGrid = document.getElementById('toolsGrid');
            toolsGrid.innerHTML = '';
            
            window.allTools.forEach(tool => {
                const toolItem = document.createElement('div');
                toolItem.className = 'tool-item';
                
                const iconPath = tool.icon ? `../assets/cast/${tool.icon}` : '../assets/cast/default-tool.png';
                
                toolItem.innerHTML = `
                    <input type="checkbox" id="tool-${tool.id}" value="${tool.name}|${tool.price}" style="display: none;">
                    <div class="tool-icon-preview">
                        <img src="${iconPath}" alt="${tool.name}" onerror="this.src='../assets/cast/default-tool.png'">
                    </div>
                    <label for="tool-${tool.id}" class="tool-name-display">${tool.name}</label>
                    <span class="tool-price">$${tool.price}</span>
                    ${tool.description ? `<div class="tool-description-preview">${tool.description.substring(0, 50)}...</div>` : ''}
                `;
                
                // Add click handler to toggle selected class
                const checkbox = toolItem.querySelector('input[type="checkbox"]');
                toolItem.addEventListener('click', () => {
                    checkbox.checked = !checkbox.checked;
                    if (checkbox.checked) {
                        toolItem.classList.add('selected');
                    } else {
                        toolItem.classList.remove('selected');
                    }
                });
                
                toolsGrid.appendChild(toolItem);
            });
        }

        // Create new user
        window.createNewUser = async function() {
            const accessCode = document.getElementById('newAccessCode').value.toUpperCase();
            const handle = document.getElementById('newHandle').value;
            const email = document.getElementById('newEmail').value;
            const characterId = document.getElementById('newCharacter').value;
            const team = document.getElementById('newTeam').value;
            const points = parseInt(document.getElementById('newPoints').value) || 0;
            const paymentAmount = parseFloat(document.getElementById('newPaymentAmount').value) || 0;
            const paid = document.getElementById('newPaid').checked;
            
            // Get selected tools
            const selectedTools = [];
            document.querySelectorAll('#toolsGrid input[type="checkbox"]:checked').forEach(checkbox => {
                const [name, price] = checkbox.value.split('|');
                selectedTools.push({ 
                    name, 
                    price: parseInt(price),
                    used: false 
                });
            });
            
            const messageDiv = document.getElementById('createUserMessage');
            
            // Validation
            if (!accessCode) {
                messageDiv.innerHTML = '<div class="message error">ACCESS CODE REQUIRED!</div>';
                return;
            }
            
            if (!handle) {
                messageDiv.innerHTML = '<div class="message error">HANDLE REQUIRED!</div>';
                return;
            }
            
            try {
                // Check if access code exists
                const existingUser = await getDoc(doc(db, 'users', accessCode));
                if (existingUser.exists()) {
                    messageDiv.innerHTML = '<div class="message error">ACCESS CODE ALREADY EXISTS!</div>';
                    return;
                }
                
                // Create user data
                const userData = {
                    handle: handle,
                    email: email || '',
                    status: 'active',
                    team: team || '',
                    paid: paid,
                    paymentAmount: paymentAmount,
                    createdAt: new Date().toISOString(),
                    characterId: '',
                    characterName: '',
                    tools: selectedTools
                };
                
                // If character selected, assign it
                if (characterId) {
                    const charDoc = await getDoc(doc(db, 'characters', characterId));
                    if (charDoc.exists() && charDoc.data().available) {
                        const charData = charDoc.data();
                        userData.characterId = characterId;
                        userData.characterName = charData.name;
                        
                        // Update character
                        await updateDoc(doc(db, 'characters', characterId), {
                            available: false,
                            ownerId: accessCode,
                            individualPoints: points,
                            teamPoints: 0
                        });
                    }
                }
                
                // Create the user
                await setDoc(doc(db, 'users', accessCode), userData);
                
                messageDiv.innerHTML = `<div class="message success">USER ${handle} (${accessCode}) CREATED! 🎉</div>`;
                
                // Clear form
                document.getElementById('newAccessCode').value = '';
                document.getElementById('newHandle').value = '';
                document.getElementById('newEmail').value = '';
                document.getElementById('newCharacter').value = '';
                document.getElementById('newTeam').value = '';
                document.getElementById('newPoints').value = '0';
                document.getElementById('newPaymentAmount').value = '0';
                document.getElementById('newPaid').checked = false;
                
                // Clear tools
                document.querySelectorAll('#toolsGrid input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.closest('.tool-item').classList.remove('selected');
                });
                
                // Reload data
                loadCharactersForDropdown();
                
            } catch (error) {
                console.error('Error creating user:', error);
                messageDiv.innerHTML = '<div class="message error">ERROR: ' + error.message + '</div>';
            }
        };

        // Load users table with tool icons
        async function loadUsers() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '<tr><td colspan="10" class="loading">Loading users</td></tr>';
            
            try {
                const snapshot = await getDocs(collection(db, 'users'));
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #666;">No users found</td></tr>';
                    return;
                }
                
                snapshot.forEach((doc) => {
                    const user = doc.data();
                    const row = document.createElement('tr');
                    const toolsCost = (user.tools || []).reduce((sum, tool) => sum + (tool.price || 0), 0);
                    const credit = Math.max(0, (user.paymentAmount || 0) - 25 - toolsCost);
                    
                    // Tools display with icons
                    let toolsHtml = 'None';
                    if (user.tools && user.tools.length > 0) {
                        toolsHtml = user.tools.map((tool, index) => {
                            const iconPath = toolIconMap[tool.name.toUpperCase()] || 'default-tool.png';
                            return `
                                <span class="tool-tag ${tool.used ? 'used' : ''}" 
                                      onclick="toggleToolUsed('${doc.id}', ${index})"
                                      title="${tool.name}">
                                    <img src="../assets/cast/${iconPath}" alt="${tool.name}" onerror="this.style.display='none'">
                                    ${tool.name}
                                </span>
                            `;
                        }).join(' ');
                    }
                    
                    row.innerHTML = `
                        <td>${doc.id}</td>
                        <td>${user.handle || 'N/A'}</td>
                        <td>${user.characterName || 'None'}</td>
                        <td class="status-${user.status}">${user.status.toUpperCase()}</td>
                        <td>
                            <select class="team-select" onchange="updateUserTeam('${doc.id}', this.value)" style="background: #000; border: 1px solid #00ff00; color: #00ff00; padding: 5px;">
                                <option value="" ${!user.team ? 'selected' : ''}>UNASSIGNED</option>
                                <option value="cable" ${user.team === 'cable' ? 'selected' : ''}>TEAM CABLE GUY</option>
                                <option value="milk" ${user.team === 'milk' ? 'selected' : ''}>TEAM MILK</option>
                            </select>
                        </td>
                        <td id="points-${doc.id}">-</td>
                        <td>
                            <span style="background: ${user.paid ? '#00ff00' : '#ff0000'}; color: ${user.paid ? '#000' : '#fff'}; padding: 5px 10px; font-weight: bold;">
                                ${user.paid ? 'PAID' : 'UNPAID'}
                            </span>
                        </td>
                        <td>$${user.paymentAmount || 0}</td>
                        <td>
                            <td style="color: ${credit > 0 ? '#00ff00' : '#ff0000'}; font-weight: bold;">
    ${credit > 0 ? '+' : ''}${credit}
</td>
                            <div class="tools-display">${toolsHtml}</div>
                        </td>
                        <td>
                            <button class="action-btn" onclick="editUser('${doc.id}')">EDIT</button>
                            <button class="action-btn danger" onclick="deleteUser('${doc.id}')">DELETE</button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                    
                    // Load character points if they have one
                    if (user.characterId) {
                        loadUserPoints(doc.id, user.characterId);
                    }
                });
            } catch (error) {
                console.error('Error loading users:', error);
                tbody.innerHTML = '<tr><td colspan="10" class="error">Error loading users</td></tr>';
            }
        }

        // Load user points
        async function loadUserPoints(userId, characterId) {
            try {
                const charDoc = await getDoc(doc(db, 'characters', characterId));
                if (charDoc.exists()) {
                    const points = charDoc.data().individualPoints || 0;
                    const pointsCell = document.getElementById(`points-${userId}`);
                    if (pointsCell) {
                        pointsCell.textContent = points;
                    }
                }
            } catch (error) {
                console.error('Error loading points:', error);
            }
        }

        // Toggle tool used status
        window.toggleToolUsed = async function(userId, toolIndex) {
            try {
                const userDoc = await getDoc(doc(db, 'users', userId));
                const userData = userDoc.data();
                const tools = userData.tools || [];
                
                if (tools[toolIndex]) {
                    tools[toolIndex].used = !tools[toolIndex].used;
                    
                    await updateDoc(doc(db, 'users', userId), {
                        tools: tools
                    });
                    
                    loadUsers();
                }
            } catch (error) {
                console.error('Error toggling tool:', error);
                alert('Error updating tool status');
            }
        };

        // Update user team
        window.updateUserTeam = async function(userId, newTeam) {
            try {
                await updateDoc(doc(db, 'users', userId), {
                    team: newTeam
                });
                console.log(`Updated ${userId} to ${newTeam || 'no team'}`);
            } catch (error) {
                console.error('Error updating team:', error);
                alert('Error updating team');
            }
        };

        // Edit user
        window.editUser = async function(userId) {
            try {
                // Get user data
                const userDoc = await getDoc(doc(db, 'users', userId));
                if (!userDoc.exists()) {
                    alert('User not found!');
                    return;
                }
                
                const userData = userDoc.data();
                window.currentEditingUser = userId;
                window.currentUserCharacter = userData.characterId;
                
                // Populate form
                document.getElementById('editAccessCode').value = userId;
                document.getElementById('editHandle').value = userData.handle || '';
                document.getElementById('editEmail').value = userData.email || '';
                document.getElementById('editStatus').value = userData.status || 'active';
                document.getElementById('editTeam').value = userData.team || '';
                document.getElementById('editPaymentAmount').value = userData.paymentAmount || 0;
                document.getElementById('editPaid').checked = userData.paid || false;
                
                // Load characters for dropdown
                const characterSelect = document.getElementById('editCharacter');
                characterSelect.innerHTML = '<option value="">-- NO CHARACTER --</option>';
                characterSelect.innerHTML += '<option value="REMOVE">❌ REMOVE CHARACTER</option>';
                
                const snapshot = await getDocs(collection(db, 'characters'));
                snapshot.forEach((doc) => {
                    const character = doc.data();
                    const option = document.createElement('option');
                    option.value = doc.id;
                    
                    if (doc.id === userData.characterId) {
                        option.textContent = `${character.name} (CURRENT)`;
                        option.selected = true;
                        option.style.color = '#00ff00';
                    } else if (character.available) {
                        option.textContent = `${character.name} (${character.show})`;
                    } else {
                        option.textContent = `${character.name} (TAKEN by ${character.ownerId})`;
                        option.disabled = true;
                        option.style.color = '#666';
                    }
                    
                    characterSelect.appendChild(option);
                });
                
                // Show modal
                document.getElementById('editModal').classList.add('active');
                
            } catch (error) {
                console.error('Error loading user for edit:', error);
                alert('Error loading user data');
            }
        };

        // Close edit modal
        window.closeEditModal = function() {
            document.getElementById('editModal').classList.remove('active');
            document.getElementById('editUserMessage').innerHTML = '';
            window.currentEditingUser = null;
            window.currentUserCharacter = null;
        };

        // Save user edit
        window.saveUserEdit = async function() {
            if (!window.currentEditingUser) return;
            
            const messageDiv = document.getElementById('editUserMessage');
            
            try {
                const userId = window.currentEditingUser;
                const newCharacterId = document.getElementById('editCharacter').value;
                const handle = document.getElementById('editHandle').value;
                const email = document.getElementById('editEmail').value;
                const status = document.getElementById('editStatus').value;
                const team = document.getElementById('editTeam').value;
                const paymentAmount = parseFloat(document.getElementById('editPaymentAmount').value) || 0;
                const paid = document.getElementById('editPaid').checked;
                const note = document.getElementById('editUserNote').value;

                
                // Update user data
                const updateData = {
                    handle: handle,
                    email: email,
                    status: status,
                    team: team,
                    paymentAmount: paymentAmount,
                    paid: paid,
                    moderatorNote: note || ''
                };
                
                // Handle character changes
                if (newCharacterId === 'REMOVE') {
                    // Remove character from user
                    updateData.characterId = '';
                    updateData.characterName = '';
                    
                    // Free up the old character
                    if (window.currentUserCharacter) {
                        await updateDoc(doc(db, 'characters', window.currentUserCharacter), {
                            available: true,
                            ownerId: '',
                            individualPoints: 0,
                            teamPoints: 0
                        });
                    }
                } else if (newCharacterId && newCharacterId !== window.currentUserCharacter) {
                    // Changed to a different character
                    const newCharDoc = await getDoc(doc(db, 'characters', newCharacterId));
                    if (!newCharDoc.exists()) {
                        messageDiv.innerHTML = '<div class="message error">Character not found!</div>';
                        return;
                    }
                    
                    const newCharData = newCharDoc.data();
                    if (!newCharData.available && newCharData.ownerId !== userId) {
                        messageDiv.innerHTML = '<div class="message error">Character is already taken!</div>';
                        return;
                    }
                    
                    // Free up the old character
                    if (window.currentUserCharacter) {
                        await updateDoc(doc(db, 'characters', window.currentUserCharacter), {
                            available: true,
                            ownerId: '',
                            individualPoints: 0,
                            teamPoints: 0
                        });
                    }
                    
                    // Assign new character
                    updateData.characterId = newCharacterId;
                    updateData.characterName = newCharData.name;
                    
                    await updateDoc(doc(db, 'characters', newCharacterId), {
                        available: false,
                        ownerId: userId,
                        individualPoints: 0,
                        teamPoints: 0
                    });
                }
                
                // Update the user
                await updateDoc(doc(db, 'users', userId), updateData);
                
                messageDiv.innerHTML = '<div class="message success">USER UPDATED SUCCESSFULLY! 🎉</div>';
                
                // Reload users table
                if (window.currentTab === 'manage-users') {
                    loadUsers();
                }
                
                // Reload characters dropdown
                loadCharactersForDropdown();
                
                // Close modal after a moment
                setTimeout(() => {
                    closeEditModal();
                }, 2000);
                
            } catch (error) {
                console.error('Error saving user edit:', error);
                messageDiv.innerHTML = '<div class="message error">ERROR: ' + error.message + '</div>';
            }
        };

        // Delete user
        window.deleteUser = async function(userId) {
            if (!confirm(`Really delete user ${userId}? This cannot be undone! 💀`)) return;
            
            try {
                // Get user data first
                const userDoc = await getDoc(doc(db, 'users', userId));
                const userData = userDoc.data();
                
                // If they have a character, free it up
                if (userData.characterId) {
                    await updateDoc(doc(db, 'characters', userData.characterId), {
                        available: true,
                        ownerId: '',
                        individualPoints: 0,
                        teamPoints: 0
                    });
                }
                
                // Delete the user
                await deleteDoc(doc(db, 'users', userId));
                
                // Reload
                loadUsers();
                loadCharactersForDropdown();
                
                alert(`User ${userId} deleted! ☠️`);
            } catch (error) {
                console.error('Error deleting user:', error);
                alert('Error deleting user');
            }
        };

        // Load characters tab
        async function loadCharacters() {
            const grid = document.getElementById('characterGrid');
            grid.innerHTML = '<div class="loading">Loading characters</div>';
            
            try {
                const snapshot = await getDocs(collection(db, 'characters'));
                grid.innerHTML = '';
                
                let available = 0;
                let taken = 0;
                
                // Create grid container
                grid.innerHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;"></div>';
                const gridContainer = grid.querySelector('div');
                
                snapshot.forEach((doc) => {
                    const char = doc.data();
                    if (char.available) available++;
                    else taken++;
                    
                    const card = document.createElement('div');
                    card.style.cssText = `
                        background: #2a2a2a;
                        border: 2px solid ${char.available ? '#00ff00' : '#ff0000'};
                        padding: 20px;
                        text-align: center;
                        position: relative;
                        ${!char.available ? 'opacity: 0.7;' : ''}
                    `;
                    
                    card.innerHTML = `
                        <div style="font-size: 24px; color: #ff00ff; margin-bottom: 10px; text-transform: uppercase;">
                            ${char.name}
                        </div>
                        <div style="font-size: 16px; color: #00ffff; margin-bottom: 10px;">
                            ${char.show}
                        </div>
                        <div style="font-size: 18px; color: ${char.available ? '#00ff00' : '#ff0000'};">
                            ${char.available ? 
                                'AVAILABLE' : 
                                `TAKEN BY ${char.ownerId || 'Unknown'}`
                            }
                        </div>
                        ${!char.available ? `
                            <div style="display: flex; gap: 20px; align-items: center; justify-content: center; margin-top: 15px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="color: #00ffff; font-size: 18px;">IND:</span>
                                    <span style="background: #000; border: 1px solid #00ff00; padding: 5px 15px; color: #00ff00; font-size: 20px; font-weight: bold;">
                                        ${char.individualPoints || 0}
                                    </span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="color: #00ffff; font-size: 18px;">TEAM:</span>
                                    <span style="background: #000; border: 1px solid #00ff00; padding: 5px 15px; color: #00ff00; font-size: 20px; font-weight: bold;">
                                        ${char.teamPoints || 0}
                                    </span>
                                </div>
                            </div>
                        ` : ''}
                    `;
                    
                    gridContainer.appendChild(card);
                });
                
                // Update stats
                document.getElementById('availableChars').textContent = available;
                document.getElementById('takenChars').textContent = taken;
                document.getElementById('totalChars').textContent = snapshot.size;
                
            } catch (error) {
                console.error('Error loading characters:', error);
                grid.innerHTML = '<div class="error">Error loading characters</div>';
            }
        }

        // Load teams
        async function loadTeams() {
            const standingsDiv = document.getElementById('teamStandings');
            standingsDiv.innerHTML = '<div class="loading">Loading teams</div>';
            
            try {
                const usersSnapshot = await getDocs(collection(db, 'users'));
                const charactersSnapshot = await getDocs(collection(db, 'characters'));
                
                // Initialize team data
                const teams = {
                    cable: { name: 'TEAM CABLE GUY 📺', members: [], points: 0 },
                    milk: { name: 'TEAM MILK 🥛', members: [], points: 0 },
                    unassigned: { name: 'UNASSIGNED ❓', members: [], points: 0 }
                };
                
                // Build character points map
                const charPoints = {};
                charactersSnapshot.forEach(doc => {
                    charPoints[doc.id] = doc.data().teamPoints || 0;
                });
                
                // Assign users to teams
                usersSnapshot.forEach(doc => {
                    const user = doc.data();
                    const teamKey = user.team || 'unassigned';
                    
                    const memberData = {
                        code: doc.id,
                        handle: user.handle,
                        character: user.characterName || 'No character',
                        status: user.status
                    };
                    
                    if (teams[teamKey]) {
                        teams[teamKey].members.push(memberData);
                        
                        // Add character's team points (only for assigned teams)
                        if (user.characterId && charPoints[user.characterId] && teamKey !== 'unassigned') {
                            teams[teamKey].points += charPoints[user.characterId];
                        }
                    } else {
                        teams.unassigned.members.push(memberData);
                    }
                });
                
                // Create ordered array
                const teamOrder = [
                    ['cable', teams.cable],
                    ['milk', teams.milk],
                    ['unassigned', teams.unassigned]
                ];
                
                // Display teams
                standingsDiv.innerHTML = teamOrder.map(([teamId, team]) => {
                    const isLeading = teamId !== 'unassigned' && 
                                    team.points > 0 && 
                                    team.points >= Math.max(teams.cable.points, teams.milk.points);
                    
                    return `
                        <div class="section" style="margin-bottom: 20px;">
                            <h3 style="font-size: 28px; color: ${teamId === 'unassigned' ? '#666' : isLeading ? '#ffff00' : '#ff00ff'}; margin-bottom: 15px;">
                                ${isLeading ? '👑 ' : ''}${team.name} - ${teamId === 'unassigned' ? '' : team.points + ' POINTS'}
                            </h3>
                            ${team.members.length === 0 ? 
                                '<p style="color: #666;">No members yet</p>' :
                                `<div style="display: grid; gap: 10px;">
                                    ${team.members.map(member => `
                                        <div style="padding: 10px; background: #2a2a2a; border-left: 3px solid ${member.status === 'active' ? '#00ff00' : '#ff0000'};">
                                            <span style="color: #00ffff;">${member.code}</span> - 
                                            <span style="color: #fff;">${member.handle}</span>
                                            <span style="float: right; color: #ffff00;">${member.character}</span>
                                        </div>
                                    `).join('')}
                                </div>`
                            }
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading teams:', error);
                standingsDiv.innerHTML = '<div class="error">Error loading teams</div>';
            }
        }

        // Add new tool with enhanced fields
        window.addNewTool = async function() {
            const name = document.getElementById('newToolName').value.toUpperCase();
            const price = parseInt(document.getElementById('newToolPrice').value);
            const icon = document.getElementById('newToolIcon').value || '';
            const description = document.getElementById('newToolDescription').value || '';
            
            const messageDiv = document.getElementById('addToolMessage');
            
            if (!name || !price) {
                messageDiv.innerHTML = '<div class="message error">NAME AND PRICE REQUIRED!</div>';
                return;
            }
            
            try {
                await addDoc(collection(db, 'tools'), {
                    name: name,
                    price: price,
                    icon: icon,
                    description: description,
                    createdAt: new Date().toISOString()
                });
                
                messageDiv.innerHTML = '<div class="message success">TOOL ADDED! 🔧</div>';
                
                // Clear form
                document.getElementById('newToolName').value = '';
                document.getElementById('newToolPrice').value = '';
                document.getElementById('newToolIcon').value = '';
                document.getElementById('newToolDescription').value = '';
                
            } catch (error) {
                console.error('Error adding tool:', error);
                messageDiv.innerHTML = '<div class="message error">ERROR: ' + error.message + '</div>';
            }
        };

        // Load tools tab with enhanced display
        async function loadToolsTab() {
            const toolsList = document.getElementById('toolsList');
            toolsList.innerHTML = '<div class="loading">Loading tools</div>';
            
            try {
                const snapshot = await getDocs(collection(db, 'tools'));
                
                if (snapshot.empty) {
                    toolsList.innerHTML = '<p style="text-align: center; color: #666;">No tools found</p>';
                    return;
                }
                
                toolsList.innerHTML = `
                    <table class="tools-management-table">
                        <thead>
                            <tr>
                                <th>ICON</th>
                                <th>NAME</th>
                                <th>PRICE</th>
                                <th>DESCRIPTION</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody id="toolsTableBody"></tbody>
                    </table>
                `;
                
                const tbody = document.getElementById('toolsTableBody');
                
                snapshot.forEach(doc => {
                    const tool = doc.data();
                    const row = document.createElement('tr');
                    
                    const iconPath = tool.icon ? `../assets/cast/${tool.icon}` : '../assets/cast/default-tool.png';
                    
                    row.innerHTML = `
                        <td class="tool-icon-cell">
                            <img src="${iconPath}" alt="${tool.name}" onerror="this.src='../assets/cast/default-tool.png'">
                        </td>
                        <td style="color: #00ffff; font-weight: bold;">${tool.name}</td>
                        <td style="color: #ffff00; font-size: 20px;">${tool.price}</td>
                        <td style="color: #999; font-style: italic; max-width: 300px;">
                            ${tool.description || 'No description'}
                        </td>
                        <td>
                            <button class="action-btn" onclick="editTool('${doc.id}')">EDIT</button>
                            <button class="action-btn danger" onclick="deleteTool('${doc.id}', '${tool.name}')">DELETE</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error loading tools:', error);
                toolsList.innerHTML = '<div class="error">Error loading tools</div>';
            }
        }

        // Delete tool
        window.deleteTool = async function(toolId, toolName) {
            if (!confirm(`Delete tool "${toolName}"? This cannot be undone!`)) return;
            
            try {
                await deleteDoc(doc(db, 'tools', toolId));
                alert(`Tool "${toolName}" deleted!`);
            } catch (error) {
                console.error('Error deleting tool:', error);
                alert('Error deleting tool');
            }
        };

        // Edit tool
        window.editTool = async function(toolId) {
            try {
                const toolDoc = await getDoc(doc(db, 'tools', toolId));
                if (!toolDoc.exists()) return;
                
                const tool = toolDoc.data();
                
                const newName = prompt('Tool Name:', tool.name);
                if (!newName) return;
                
                const newPrice = prompt('Price (no $ sign):', tool.price);
                if (!newPrice) return;
                
                const newIcon = prompt('Icon filename (e.g., labubu-voodoo.png):', tool.icon || '');
                const newDescription = prompt('Description:', tool.description || '');
                
                await updateDoc(doc(db, 'tools', toolId), {
                    name: newName.toUpperCase(),
                    price: parseInt(newPrice),
                    icon: newIcon,
                    description: newDescription
                });
                
                alert('Tool updated!');
                loadToolsTab();
                
            } catch (error) {
                console.error('Error editing tool:', error);
                alert('Error editing tool');
            }
        };

        // Load pending selections
        async function loadPendingSelections() {
            const pendingDiv = document.getElementById('pendingList');
            pendingDiv.innerHTML = '<div class="loading">Loading pending selections</div>';
            
            try {
                const snapshot = await getDocs(collection(db, 'pendingSelections'));
                
                if (snapshot.empty) {
                    pendingDiv.innerHTML = '<p style="text-align: center; color: #666;">No pending selections</p>';
                    return;
                }
                
                pendingDiv.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const selection = doc.data();
                    
                    const card = document.createElement('div');
                    card.style.cssText = `
                        background: #2a2a2a;
                        border: 2px solid #ffff00;
                        padding: 20px;
                        margin-bottom: 20px;
                        position: relative;
                    `;
                    
                    const toolsList = selection.tools && selection.tools.length > 0 ? 
                        selection.tools.map(t => `${t.name} (${t.price})`).join(', ') : 
                        'No tools';
                    
                    card.innerHTML = `
                        <div style="display: grid; gap: 10px;">
                            <div><strong style="color: #00ffff;">Access Code:</strong> ${selection.accessCode}</div>
                            <div><strong style="color: #00ffff;">Character:</strong> ${selection.characterName}</div>
                            <div><strong style="color: #00ffff;">Tools:</strong> ${toolsList}</div>
                            <div><strong style="color: #00ffff;">Total Cost:</strong> <span style="color: #ffff00; font-size: 20px;">${selection.totalCost}</span></div>
                            <div><strong style="color: #00ffff;">Submitted:</strong> ${new Date(selection.submittedAt).toLocaleString()}</div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="action-btn" style="background: #00ff00;" onclick="approvePending('${doc.id}')">
                                APPROVE ✓
                            </button>
                            <button class="action-btn danger" onclick="rejectPending('${doc.id}')">
                                REJECT ✗
                            </button>
                        </div>
                    `;
                    
                    pendingDiv.appendChild(card);
                });
                
            } catch (error) {
                console.error('Error loading pending selections:', error);
                pendingDiv.innerHTML = '<div class="error">Error loading pending selections</div>';
            }
        }

        // Approve pending selection
        window.approvePending = async function(pendingId) {
            try {
                const pendingDoc = await getDoc(doc(db, 'pendingSelections', pendingId));
                if (!pendingDoc.exists()) return;
                
                const selection = pendingDoc.data();
                
                // Get user
                const userDoc = await getDoc(doc(db, 'users', selection.accessCode));
                if (!userDoc.exists()) {
                    alert('User not found!');
                    return;
                }
                
                const userData = userDoc.data();
                
                // Update character availability
                await updateDoc(doc(db, 'characters', selection.characterId), {
                    available: false,
                    ownerId: selection.accessCode,
                    individualPoints: 0,
                    teamPoints: 0
                });
                
                // Update user with character and tools
                await updateDoc(doc(db, 'users', selection.accessCode), {
                    characterId: selection.characterId,
                    characterName: selection.characterName,
                    tools: selection.tools || [],
                    paymentAmount: selection.totalCost
                });
                
                // Delete pending selection
                await deleteDoc(doc(db, 'pendingSelections', pendingId));
                
                alert(`Selection approved for ${selection.accessCode}!`);
                loadPendingSelections();
                
            } catch (error) {
                console.error('Error approving selection:', error);
                alert('Error approving selection');
            }
        };

        // Reject pending selection
        window.rejectPending = async function(pendingId) {
            if (!confirm('Reject this selection?')) return;
            
            try {
                await deleteDoc(doc(db, 'pendingSelections', pendingId));
                alert('Selection rejected!');
                loadPendingSelections();
            } catch (error) {
                console.error('Error rejecting selection:', error);
                alert('Error rejecting selection');
            }
        };

        // Setup realtime listeners
        function setupRealtimeListeners() {
            // Listen for user changes
            onSnapshot(collection(db, 'users'), (snapshot) => {
                console.log('Users updated');
                if (window.currentTab === 'dashboard') loadDashboard();
            });
            
            // Listen for character changes
            onSnapshot(collection(db, 'characters'), (snapshot) => {
                console.log('Characters updated');
                loadCharactersForDropdown();
            });

            // Listen for tools changes
            onSnapshot(collection(db, 'tools'), (snapshot) => {
                console.log('Tools updated');
                loadToolsFromFirebase().then(() => {
                    loadToolsGrid();
                    if (window.currentTab === 'tools') loadToolsTab();
                });
            });
            
            // Listen for pending selections
            onSnapshot(collection(db, 'pendingSelections'), (snapshot) => {
                console.log('Pending selections updated');
                if (window.currentTab === 'pending') loadPendingSelections();
                
                // Update dashboard count
                const pendingCount = snapshot.size;
                const pendingTab = Array.from(document.querySelectorAll('.tab-btn')).find(btn => 
                    btn.textContent.includes('PENDING')
                );
                if (pendingTab) {
                    pendingTab.textContent = `PENDING${pendingCount > 0 ? ` (${pendingCount})` : ''}`;
                }
            });
        }
    </script>
</body>
</html>