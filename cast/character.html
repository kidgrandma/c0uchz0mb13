<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internet Olympics 2 - Select Your Character</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #008080;
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        /* Windows 95 Base Styles */
        .window-95 {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            box-shadow: inset -1px -1px #808080, inset 1px 1px #dfdfdf;
        }

        /* Y2K Video Store Vibe */
        .main-container {
            min-height: 100vh;
            padding: 20px;
            position: relative;
            background: transparent;
        }

        /* Video Background */
        .video-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            opacity: 0.7;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            z-index: 10;
        }

        .header h1 {
            font-size: clamp(32px, 6vw, 64px);
            color: #ffff00;
            text-shadow: 3px 3px 0px #ff00ff, 4px 4px 0px #000;
            margin-bottom: 10px;
            letter-spacing: 2px;
            font-family: 'Times New Roman', Times, serif;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .subtitle {
            color: #00ff00;
            font-size: clamp(14px, 2.5vw, 20px);
            letter-spacing: 2px;
            text-transform: uppercase;
            text-shadow: 2px 2px #000;
        }

        /* Access Code Entry */
        .access-code-container {
            max-width: 400px;
            width: 90%;
            margin: 50px auto;
            background: #ff00ff;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            box-shadow: inset -1px -1px #cc00cc, inset 1px 1px #ff66ff;
            padding: 30px;
            text-align: center;
        }

        .access-code-container h2 {
            color: #000;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .access-code-input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 2px solid;
            border-color: #000000 #ffffff #ffffff #000000;
            background: #ffff00;
            color: #000;
            margin-bottom: 20px;
            font-family: Arial, sans-serif;
            text-transform: uppercase;
            font-weight: bold;
        }

        .access-code-btn {
            background: #00ff00;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            color: #000;
            padding: 10px 30px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            width: 100%;
            box-shadow: inset -1px -1px #00cc00, inset 1px 1px #66ff66;
        }

        .access-code-btn:active {
            border-color: #000000 #ffffff #ffffff #000000;
        }

        .error-message {
            color: #ff0000;
            font-size: 14px;
            margin-top: 10px;
            display: none;
            background: #ffff00;
            padding: 5px;
            font-weight: bold;
        }

        /* View Toggle */
        .view-toggle {
            text-align: center;
            margin-bottom: 30px;
            display: none;
        }

        .toggle-btn {
            background: #ff00ff;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            color: #000;
            padding: 10px 25px;
            margin: 0 5px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: inset -1px -1px #cc00cc, inset 1px 1px #ff66ff;
        }

        .toggle-btn:hover {
            background: #ff66ff;
        }

        .toggle-btn.active {
            background: #00ff00;
            border-color: #000000 #ffffff #ffffff #000000;
            box-shadow: inset -1px -1px #00cc00, inset 1px 1px #66ff66;
        }

        /* CD Carousel Container */
        .carousel-wrapper {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
            height: clamp(350px, 50vh, 500px);
            perspective: 1200px;
            display: none;
        }

        .carousel {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Grid View */
        .grid-wrapper {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .discs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        @media (min-width: 768px) {
            .discs-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 30px;
            }
        }

        .grid-disc {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .grid-disc:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 0 20px #ff00ff);
        }

        .grid-disc img {
            width: 100%;
            height: auto;
            display: block;
        }

        .disc-sleeve {
            position: absolute;
            width: clamp(200px, 30vw, 300px);
            height: clamp(200px, 30vw, 300px);
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .disc-sleeve img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
        }

        .disc-sleeve.active {
            z-index: 10;
        }

        .disc-sleeve.prev {
            transform: translate(-150%, -50%) scale(0.8) rotateY(25deg);
            opacity: 0.7;
            filter: blur(1px);
        }

        .disc-sleeve.next {
            transform: translate(50%, -50%) scale(0.8) rotateY(-25deg);
            opacity: 0.7;
            filter: blur(1px);
        }

        .disc-sleeve.far-prev,
        .disc-sleeve.far-next {
            opacity: 0;
            pointer-events: none;
        }

        /* Navigation */
        .nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: #00ff00;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            color: #000;
            font-size: clamp(24px, 3vw, 36px);
            width: clamp(40px, 5vw, 60px);
            height: clamp(40px, 5vw, 60px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20;
            font-weight: bold;
            box-shadow: inset -1px -1px #00cc00, inset 1px 1px #66ff66;
        }

        .nav-arrow:hover {
            background: #66ff66;
        }

        .nav-arrow:active {
            border-color: #000000 #ffffff #ffffff #000000;
        }

        .nav-arrow.prev { left: 10px; }
        .nav-arrow.next { right: 10px; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            display: none;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            box-shadow: inset -1px -1px #808080, inset 1px 1px #dfdfdf;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            background: linear-gradient(to right, #000080, #1084d0);
            color: #fff;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: bold;
            font-size: 14px;
        }

        .modal-inner {
            padding: 20px;
        }

        @media (min-width: 768px) {
            .modal-inner {
                padding: 30px;
            }
        }

        .modal-disc {
            width: clamp(150px, 30vw, 250px);
            height: clamp(150px, 30vw, 250px);
            margin: 0 auto 20px;
            animation: spin 20s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .modal-disc img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 20px #ff00ff);
        }

        .character-name {
            text-align: center;
            font-size: clamp(20px, 4vw, 28px);
            color: #000;
            margin-bottom: 5px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .character-show {
            text-align: center;
            font-size: clamp(14px, 2.5vw, 18px);
            color: #666;
            margin-bottom: 20px;
            font-style: italic;
        }

        /* Weapons Grid */
        .weapons-section {
            margin-top: 30px;
        }

        .weapons-title {
            color: #000;
            font-size: clamp(16px, 3vw, 20px);
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
        }

        .weapons-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }

        @media (min-width: 480px) {
            .weapons-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
        }

        @media (min-width: 768px) {
            .weapons-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
            }
        }

        .weapon-item {
            background: #ffffff;
            border: 2px solid;
            border-color: #000000 #ffffff #ffffff #000000;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .weapon-item:hover {
            background: #e0e0e0;
        }

        .weapon-item.selected {
            background: #00ff00;
            border-color: #ffffff #000000 #000000 #ffffff;
            box-shadow: inset -1px -1px #00cc00, inset 1px 1px #66ff66;
        }

        .weapon-item.selected .weapon-name {
            color: #000;
            font-weight: bold;
        }

        .weapon-name {
            font-size: clamp(10px, 1.5vw, 12px);
            color: #000;
            font-weight: bold;
            text-transform: uppercase;
        }

        .weapon-emoji {
            font-size: clamp(20px, 3vw, 24px);
            margin-top: 5px;
        }

        .weapon-quantity {
            background: #ff00ff;
            color: #fff;
            font-size: 12px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 50%;
            position: absolute;
            top: 5px;
            right: 5px;
            min-width: 20px;
            display: none;
            text-align: center;
            border: 1px solid #000;
        }

        /* Cart Summary */
        .cart-summary {
            background: #ffff00;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            box-shadow: inset -1px -1px #cccc00, inset 1px 1px #ffffcc;
        }

        .total-price {
            font-size: clamp(16px, 3vw, 20px);
            color: #000;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .checkout-btn {
            background: #ff00ff;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            color: #000;
            padding: 10px 30px;
            font-size: clamp(14px, 2.5vw, 16px);
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            width: 100%;
            margin-bottom: 10px;
            box-shadow: inset -1px -1px #cc00cc, inset 1px 1px #ff66ff;
        }

        .checkout-btn:active {
            border-color: #000000 #ffffff #ffffff #000000;
        }

        .checkout-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .start-over-btn {
            background: #ff6666;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            color: #000;
            padding: 8px 20px;
            font-size: clamp(12px, 2vw, 14px);
            cursor: pointer;
            text-transform: uppercase;
            width: 100%;
            box-shadow: inset -1px -1px #cc0000, inset 1px 1px #ff9999;
        }

        /* Payment Instructions */
        .payment-modal {
            background: #00ff00;
            border: 2px solid #000;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }

        .payment-modal h3 {
            color: #000;
            margin-bottom: 15px;
            font-size: clamp(16px, 3vw, 20px);
        }

        .payment-modal p {
            color: #000;
            margin-bottom: 10px;
            font-size: clamp(14px, 2.5vw, 16px);
        }

        .payment-modal .payment-handles {
            background: #ff00ff;
            border: 2px solid #000;
            padding: 15px;
            margin: 15px 0;
        }

        .payment-modal .payment-handles strong {
            display: block;
            margin-bottom: 10px;
            color: #000;
            font-size: clamp(14px, 2.5vw, 16px);
        }

        .payment-modal .emoji-line {
            font-size: clamp(20px, 3vw, 24px);
            margin: 15px 0;
            letter-spacing: 5px;
        }

        .close-modal {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            color: #000;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            padding: 0;
            line-height: 1;
            box-shadow: inset -1px -1px #808080, inset 1px 1px #dfdfdf;
        }

        .close-modal:active {
            border-color: #000000 #ffffff #ffffff #000000;
        }

        /* Pending Status */
        .pending-status {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            padding: 30px 20px;
            margin: 20px auto;
            max-width: 600px;
            width: 90%;
            text-align: center;
            display: none;
            box-shadow: inset -1px -1px #808080, inset 1px 1px #dfdfdf;
        }

        .pending-status h3 {
            color: #000;
            margin-bottom: 20px;
            font-size: clamp(18px, 3vw, 24px);
        }

        .pending-disc {
            width: clamp(150px, 30vw, 200px);
            height: clamp(150px, 30vw, 200px);
            margin: 20px auto;
            animation: spin 20s linear infinite;
        }

        .pending-disc img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 10px #ff00ff);
        }

        .change-selection-btn {
            background: #00ffff;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            color: #000;
            padding: 10px 30px;
            font-size: clamp(14px, 2.5vw, 16px);
            cursor: pointer;
            text-transform: uppercase;
            margin-top: 20px;
            font-weight: bold;
            box-shadow: inset -1px -1px #00cccc, inset 1px 1px #66ffff;
        }

        /* Player Profile Modal - Matching Pending Style */
        .player-profile {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            padding: 30px 20px;
            max-width: 600px;
            width: 90%;
            margin: 20px auto;
            display: none;
            box-shadow: inset -1px -1px #808080, inset 1px 1px #dfdfdf;
            text-align: center;
        }

        .profile-disc {
            width: clamp(150px, 30vw, 200px);
            height: clamp(150px, 30vw, 200px);
            margin: 20px auto;
            animation: spin 20s linear infinite;
        }

        .profile-disc img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 10px #ff00ff);
        }

        .profile-info {
            margin: 20px 0;
        }

        .profile-info p {
            margin: 10px 0;
            font-size: clamp(14px, 2.5vw, 16px);
            color: #000;
        }

        .profile-info strong {
            color: #000080;
        }

        .status-active {
            color: #00cc00;
            font-weight: bold;
        }

        .status-approved {
            color: #00cc00;
            font-weight: bold;
        }

        .emoji-line {
            font-size: 24px;
            margin: 20px 0;
        }

        /* Simplified stats */
        .profile-stats-simple {
            background: #e0e0e0;
            border: 2px solid;
            border-color: #000000 #ffffff #ffffff #000000;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }

        .stat-line {
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
        }

        /* Tools list simplified */
        .tools-simple {
            background: #f0f0f0;
            border: 2px solid;
            border-color: #000000 #ffffff #ffffff #000000;
            padding: 15px;
            margin: 20px 0;
        }

        .tools-simple h4 {
            color: #000;
            margin-bottom: 10px;
            font-size: clamp(16px, 3vw, 18px);
        }

        .tool-item-simple {
            display: inline-block;
            margin: 5px;
            padding: 5px 10px;
            background: #00ff00;
            border: 1px solid #000;
            font-size: clamp(12px, 2vw, 14px);
        }

        .tool-item-simple.used {
            background: #999;
            text-decoration: line-through;
        }

        .home-button {
            background: #ffff00;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            color: #000;
            padding: 12px 40px;
            font-size: clamp(16px, 2.5vw, 18px);
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            margin: 30px auto 0;
            display: block;
            letter-spacing: 2px;
            box-shadow: inset -1px -1px #cccc00, inset 1px 1px #ffffcc;
        }

        .home-button:active {
            border-color: #000000 #ffffff #ffffff #000000;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                max-width: 95%;
                padding: 0;
            }

            .modal-inner {
                padding: 15px;
            }

            .carousel-wrapper {
                height: 350px;
            }

            .disc-sleeve {
                width: 200px;
                height: 200px;
            }

            .nav-arrow {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .modal-disc {
                width: 150px;
                height: 150px;
            }

            .profile-character-img {
                width: 200px;
            }

            .character-name {
                font-size: 20px;
            }

            .weapons-title {
                font-size: 16px;
            }

            .weapons-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .weapon-item {
                padding: 12px 8px;
            }

            .discs-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 28px;
            }

            .subtitle {
                font-size: 14px;
            }

            .modal-content {
                width: 100%;
                border-radius: 0;
            }

            .modal-inner {
                padding: 10px;
            }

            .modal-disc {
                width: 120px;
                height: 120px;
            }

            .character-name {
                font-size: 18px;
            }

            .character-show {
                font-size: 14px;
            }

            .weapons-grid {
                gap: 8px;
            }

            .weapon-name {
                font-size: 10px;
            }

            .weapon-emoji {
                font-size: 18px;
            }

            .cart-summary {
                padding: 15px;
            }

            .checkout-btn {
                padding: 8px 20px;
                font-size: 14px;
            }

            .payment-modal {
                padding: 15px;
            }

            .payment-modal h3 {
                font-size: 16px;
            }

            .payment-modal p {
                font-size: 14px;
            }

            .discs-grid {
                padding: 10px;
            }

            .pending-status {
                padding: 20px 15px;
            }

            .player-profile {
                padding: 15px;
            }

            .profile-header {
                padding: 15px;
            }

            .profile-character-img {
                width: 150px;
            }

            .profile-name {
                font-size: 20px;
            }

            .profile-stats {
                gap: 10px;
            }

            .stat-row {
                padding: 10px;
            }

            .tools-list {
                gap: 8px;
                padding: 10px;
            }
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 50px;
            color: #00ff00;
            font-size: clamp(18px, 3vw, 24px);
            text-shadow: 0 0 10px #00ff00;
        }

        /* Instructions */
        .instructions {
            text-align: center;
            color: #ffff00;
            font-size: clamp(14px, 2.5vw, 16px);
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 1px 1px #ff00ff;
        }
    </style>
</head>
<body>
    <video class="video-bg" id="videoBg" autoplay muted loop playsinline>
        <source src="../assets/cast/cast-access.mp4" type="video/mp4">
    </video>
    
    <!-- Background Music -->
    <audio id="bgMusic" autoplay loop>
        <source src="../assets/cast/encore.mp3" type="audio/mpeg">
    </audio>
    
    <div class="main-container">
        <div class="header">
            <h1>INTERNET OLYMPICS 2</h1>
            <p class="subtitle">SELECT YOUR FIGHTER</p>
        </div>

        <!-- Access Code Entry -->
        <div class="access-code-container window-95" id="accessCodeContainer">
            <h2>ENTER ACCESS CODE</h2>
            <input type="text" 
                   class="access-code-input" 
                   id="accessCodeInput" 
                   placeholder="ENTER CODE"
                   maxlength="20">
            <button class="access-code-btn" onclick="validateAccessCode()">ENTER</button>
            <div class="error-message" id="errorMessage">INVALID ACCESS CODE</div>
        </div>

        <!-- View Toggle -->
        <div class="view-toggle" id="viewToggle">
            <button class="toggle-btn active" onclick="switchView('carousel')">CAROUSEL</button>
            <button class="toggle-btn" onclick="switchView('grid')">GRID</button>
        </div>

        <!-- Character Selection - Carousel -->
        <div class="carousel-wrapper" id="carouselWrapper">
            <div class="carousel" id="carousel">
                <div class="loading">Loading character discs...</div>
            </div>
            <button class="nav-arrow prev" onclick="navigateCarousel('prev')">‚Äπ</button>
            <button class="nav-arrow next" onclick="navigateCarousel('next')">‚Ä∫</button>
        </div>

        <!-- Character Selection - Grid -->
        <div class="grid-wrapper" id="gridWrapper">
            <div class="discs-grid" id="discsGrid">
                <div class="loading">Loading character discs...</div>
            </div>
        </div>

        <p class="instructions" id="instructions" style="display: none;">
            ‚ñì‚ñí‚ñë CLICK THE DISC TO SELECT YOUR CHARACTER ‚ñë‚ñí‚ñì
        </p>

        <!-- Pending Status -->
        <div class="pending-status window-95" id="pendingStatus">
            <h3>YOUR SELECTION IS PENDING APPROVAL</h3>
            <div class="pending-disc" id="pendingDisc"></div>
            <div id="pendingInfo"></div>
            <div style="font-size: 24px; margin: 20px 0;">üçìüçíüî™üî•üêºüçÑ</div>
            <button class="change-selection-btn" onclick="changeSelection()">CHANGE SELECTION</button>
        </div>

        <!-- Player Profile -->
        <div class="player-profile window-95" id="playerProfile">
            <h3>YOUR CHARACTER PROFILE</h3>
            <div class="profile-disc" id="profileDisc"></div>
            <div class="profile-info" id="profileInfo"></div>
            <div style="font-size: 24px; margin: 20px 0;">üéÆüíøüèÜ‚ú®üî•üéØ</div>
            <button class="home-button" onclick="window.location.href='../index.html'">
                RETURN HOME üè†üíæ‚ú®
            </button>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content window-95">
            <div class="modal-header">
                <span>CHARACTER SELECTION</span>
                <button class="close-modal" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-inner">
                <div class="modal-disc">
                    <img id="modalDiscImg" src="" alt="">
                </div>
                <h2 class="character-name" id="characterName"></h2>
                <p class="character-show" id="characterShow"></p>
                
                <div class="weapons-section">
                    <h3 class="weapons-title">‚ñì‚ñí‚ñë POWER-UPS & WEAPONS ‚ñë‚ñí‚ñì</h3>
                    <div class="weapons-grid" id="weaponsGrid"></div>
                </div>

                <div class="cart-summary">
                    <div class="total-price" id="totalPriceDiv">SELECT YOUR TOOLS!</div>
                    <button class="checkout-btn" id="checkoutBtn" onclick="proceedToCheckout()">CHECKOUT ‚Üí</button>
                    
                    <!-- Payment Instructions (hidden initially) -->
                    <div class="payment-modal" id="paymentModal">
                        <h3>SELECTION SENT FOR APPROVAL!</h3>
                        <div class="emoji-line">üé≠üíøüì∏üî•‚≠êüëÅÔ∏è</div>
                        <p id="paymentMessage"></p>
                        <div class="payment-handles">
                            <strong>VENMO: @worksucksdotnet</strong>
                            <strong>ZELLE: paizley@worksucks.net</strong>
                        </div>
                        <p style="color: #000; font-weight: bold; background: #ff00ff; padding: 10px; margin-top: 20px;">
                            IMPORTANT: Include your Instagram handle in the payment description!
                        </p>
                        <div class="emoji-line">üê∏üçÑüé±üíïü•öüß≤</div>
                        <p style="font-size: 20px; color: #000; margin-top: 20px;">
                            SEE U SOOOOON XOXOXOXOX ‚ô•‚ô•‚ô•<br>
                            - mod
                        </p>
                    </div>
                    
                    <button class="start-over-btn" id="startOverBtn" style="display: none;" onclick="startOver()">START OVER</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { 
            getFirestore, 
            collection, 
            getDocs, 
            doc, 
            getDoc, 
            setDoc, 
            addDoc,
            deleteDoc,
            query,
            where,
            onSnapshot
        } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDJ8uiR2qEUfXIuFEO21-40668WNpOdj2w",
            authDomain: "c0uchz0mb13.firebaseapp.com",
            projectId: "c0uchz0mb13",
            storageBucket: "c0uchz0mb13.firebasestorage.app",
            messagingSenderId: "1051521591004",
            appId: "1:1051521591004:web:1301f129fc0f3032f6f619",
            measurementId: "G-6BNDYZQRPE"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Attempt to play background music
        document.addEventListener('DOMContentLoaded', function() {
            const bgMusic = document.getElementById('bgMusic');
            if (bgMusic) {
                bgMusic.volume = 0.5; // Set volume to 50%
                
                // Try to play music
                const playPromise = bgMusic.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log('Music started playing automatically');
                    }).catch(error => {
                        console.log('Autoplay prevented, will play on first user interaction');
                        
                        // Play on first user interaction
                        const playOnInteraction = () => {
                            bgMusic.play();
                            document.removeEventListener('click', playOnInteraction);
                            document.removeEventListener('keydown', playOnInteraction);
                            document.removeEventListener('touchstart', playOnInteraction);
                        };
                        
                        document.addEventListener('click', playOnInteraction);
                        document.addEventListener('keydown', playOnInteraction);
                        document.addEventListener('touchstart', playOnInteraction);
                    });
                }
            }
        });

        // Global variables
        window.characters = [];
        window.availableCharacters = [];
        window.currentIndex = 0;
        window.selectedWeapons = {};  // Changed to object to track quantities
        window.currentCharacter = null;
        window.currentAccessCode = null;
        window.currentUser = null;
        window.touchStartX = 0;
        window.touchEndX = 0;
        window.currentView = 'carousel';
        window.pendingSelectionId = null;

        // Weapons data with emojis
        const weapons = [
            { name: "LASER POINTER", price: 5, emoji: "üî¥üí´" },
            { name: "USB KILLSTICK", price: 15, emoji: "üíæüî™" },
            { name: "ENERGY DRINK", price: 3, emoji: "‚ö°ü•§" },
            { name: "KEYBOARD WARRIOR", price: 8, emoji: "‚å®Ô∏è‚öîÔ∏è" },
            { name: "WIFI JAMMER", price: 12, emoji: "üì°üö´" },
            { name: "MEME CANNON", price: 10, emoji: "üéØüí•" },
            { name: "PIXEL SWORD", price: 7, emoji: "üó°Ô∏è‚ú®" },
            { name: "GLITCH BOMB", price: 9, emoji: "üí£üåà" }
        ];

        // Validate access code
        window.validateAccessCode = async function() {
            const code = document.getElementById('accessCodeInput').value.toUpperCase();
            if (!code) return;

            try {
                const userDoc = await getDoc(doc(db, 'users', code));
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    
                    // Check if user is blocked or dead
                    if (userData.status === 'blocked' || userData.status === 'dead') {
                        document.getElementById('errorMessage').textContent = 
                            userData.status === 'blocked' ? 'ACCESS DENIED - ACCOUNT BLOCKED' : 'ACCESS DENIED - PLAYER ELIMINATED';
                        document.getElementById('errorMessage').style.display = 'block';
                        return;
                    }

                    window.currentAccessCode = code;
                    window.currentUser = userData;
                    
                    // Switch video background
                    const videoBg = document.getElementById('videoBg');
                    if (videoBg) {
                        videoBg.src = '../assets/cast/loop-bg.mp4';
                        videoBg.load();
                        videoBg.play();
                    }
                    
                    // Hide access code screen with a slight delay for video transition
                    setTimeout(() => {
                        document.getElementById('accessCodeContainer').style.display = 'none';
                        
                        // Check if user already has a character or pending selection
                        if (userData.characterId) {
                            showPlayerProfile(userData);
                        } else {
                            checkPendingSelection(code);
                        }
                    }, 500);
                    
                } else {
                    document.getElementById('errorMessage').style.display = 'block';
                }
            } catch (error) {
                console.error('Error validating access code:', error);
                document.getElementById('errorMessage').style.display = 'block';
            }
        };

        // Check for pending selections
        async function checkPendingSelection(accessCode) {
            const q = query(collection(db, 'pendingSelections'), where('accessCode', '==', accessCode));
            const querySnapshot = await getDocs(q);
            
            if (!querySnapshot.empty) {
                const pendingDoc = querySnapshot.docs[0];
                window.pendingSelectionId = pendingDoc.id;
                const pendingData = pendingDoc.data();
                showPendingStatus(pendingData);
            } else {
                // Show character selection
                document.getElementById('viewToggle').style.display = 'block';
                document.getElementById('carouselWrapper').style.display = 'block';
                document.getElementById('instructions').style.display = 'block';
                loadCharacters();
            }
        }

        // Show pending status with disc image
        function showPendingStatus(pendingData) {
            // Hide character selection elements
            document.getElementById('viewToggle').style.display = 'none';
            document.getElementById('carouselWrapper').style.display = 'none';
            document.getElementById('gridWrapper').style.display = 'none';
            document.getElementById('instructions').style.display = 'none';
            
            const statusDiv = document.getElementById('pendingStatus');
            const discDiv = document.getElementById('pendingDisc');
            const infoDiv = document.getElementById('pendingInfo');
            
            // Show disc image
            discDiv.innerHTML = `<img src="../assets/cast/cast-members/${pendingData.characterId}-disc.png" alt="${pendingData.characterName}">`;
            
            // Show info
            const toolsList = pendingData.tools ? pendingData.tools.map(t => t.name).join(', ') : 'None';
            infoDiv.innerHTML = `
                <p><strong>Character:</strong> ${pendingData.characterName}</p>
                <p><strong>Tools:</strong> ${toolsList}</p>
                <p style="font-size: 24px; color: #ff00ff; margin-top: 20px;">Don't forget to send payment!</p>
                <p><strong>VENMO:</strong> @worksucksdotnet</p>
                <p><strong>ZELLE:</strong> paizley@worksucks.net</p>
                <p style="margin-top: 15px;">Total: ${pendingData.totalCost}</p>
            `;
            
            statusDiv.style.display = 'block';
        }

        // Change selection - delete pending and restart
        window.changeSelection = async function() {
            if (window.pendingSelectionId) {
                try {
                    await deleteDoc(doc(db, 'pendingSelections', window.pendingSelectionId));
                    window.pendingSelectionId = null;
                    
                    // Hide pending status and show selection
                    document.getElementById('pendingStatus').style.display = 'none';
                    document.getElementById('viewToggle').style.display = 'block';
                    document.getElementById('carouselWrapper').style.display = 'block';
                    document.getElementById('instructions').style.display = 'block';
                    loadCharacters();
                } catch (error) {
                    console.error('Error deleting pending selection:', error);
                    alert('Error changing selection. Please try again.');
                }
            }
        };

        // Show player profile
        function showPlayerProfile(userData) {
            // Hide character selection elements
            document.getElementById('viewToggle').style.display = 'none';
            document.getElementById('carouselWrapper').style.display = 'none';
            document.getElementById('gridWrapper').style.display = 'none';
            document.getElementById('instructions').style.display = 'none';
            
            const profileDiv = document.getElementById('playerProfile');
            const discDiv = document.getElementById('profileDisc');
            const infoDiv = document.getElementById('profileInfo');
            
            // Show disc image
            discDiv.innerHTML = `<img src="../assets/cast/cast-members/${userData.characterId}-disc.png" alt="${userData.characterName}">`;
            
            // Get character info and points
            Promise.all([
                getCharacterShow(userData.characterId),
                getCharacterPoints(userData.characterId)
            ]).then(([show, points]) => {
                // Create tools list
                let toolsList = 'None';
                if (userData.tools && userData.tools.length > 0) {
                    toolsList = userData.tools.map(tool => 
                        `<span class="tool-item-simple${tool.used ? ' used' : ''}">${tool.name}</span>`
                    ).join(' ');
                }
                
                // Build info HTML
                infoDiv.innerHTML = `
                    <p><strong>Character:</strong> ${userData.characterName || userData.characterId}</p>
                    <p><strong>Show:</strong> ${show}</p>
                    <p><strong>Status:</strong> <span class="status-${userData.status.toLowerCase()}">${userData.status.toUpperCase()}</span></p>
                    <div class="profile-stats-simple">
                        <div class="stat-line">
                            <span><strong>Team:</strong></span>
                            <span>${userData.team || 'No Team'}</span>
                        </div>
                        <div class="stat-line">
                            <span><strong>Individual Points:</strong></span>
                            <span>${points.individual}</span>
                        </div>
                        <div class="stat-line">
                            <span><strong>Team Points:</strong></span>
                            <span>${points.team}</span>
                        </div>
                    </div>
                    <div class="tools-simple">
                        <h4>YOUR WEAPONS:</h4>
                        ${toolsList}
                    </div>
                `;
                
                profileDiv.style.display = 'block';
            });
        }

        // Get character show info
        async function getCharacterShow(characterId) {
            try {
                const charDoc = await getDoc(doc(db, 'characters', characterId));
                if (charDoc.exists()) {
                    return charDoc.data().show || 'Unknown Show';
                }
            } catch (error) {
                console.error('Error getting character show:', error);
            }
            return 'Unknown Show';
        }

        // Get character points
        async function getCharacterPoints(characterId) {
            try {
                const charDoc = await getDoc(doc(db, 'characters', characterId));
                if (charDoc.exists()) {
                    const data = charDoc.data();
                    return {
                        individual: data.individualPoints || 0,
                        team: data.teamPoints || 0
                    };
                }
            } catch (error) {
                console.error('Error getting character points:', error);
            }
            return { individual: 0, team: 0 };
        }

        // Switch view
        window.switchView = function(view) {
            window.currentView = view;
            
            // Update toggle buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show/hide views
            if (view === 'carousel') {
                document.getElementById('carouselWrapper').style.display = 'block';
                document.getElementById('gridWrapper').style.display = 'none';
            } else {
                document.getElementById('carouselWrapper').style.display = 'none';
                document.getElementById('gridWrapper').style.display = 'block';
            }
        };

        // Load characters from Firebase (only available ones)
        async function loadCharacters() {
            console.log('Starting to load characters...');
            try {
                const querySnapshot = await getDocs(collection(db, 'characters'));
                window.characters = [];
                window.availableCharacters = [];
                
                querySnapshot.forEach((doc) => {
                    const charData = doc.data();
                    if (charData.available) {
                        const character = {
                            id: doc.id,
                            ...charData
                        };
                        window.characters.push(character);
                        window.availableCharacters.push(character);
                    }
                });

                console.log(`Found ${window.availableCharacters.length} available characters`);
                initCarousel();
                initGrid();
            } catch (error) {
                console.error('Error loading characters:', error);
                alert('Error loading characters: ' + error.message);
            }
        }

        // Initialize carousel (only with available characters)
        function initCarousel() {
            const carousel = document.getElementById('carousel');
            carousel.innerHTML = '';

            window.availableCharacters.forEach((char, index) => {
                const sleeve = document.createElement('div');
                sleeve.className = 'disc-sleeve';
                sleeve.dataset.index = index;
                sleeve.dataset.character = char.id;
                
                const img = document.createElement('img');
                img.src = `../assets/cast/cast-members/${char.id}.png`;
                img.alt = char.name;
                
                sleeve.appendChild(img);
                carousel.appendChild(sleeve);

                // Click handler for disc selection
                sleeve.addEventListener('click', () => selectCharacter(char));
            });

            updateCarousel();
        }

        // Initialize grid view
        function initGrid() {
            const grid = document.getElementById('discsGrid');
            grid.innerHTML = '';

            window.availableCharacters.forEach((char) => {
                const gridDisc = document.createElement('div');
                gridDisc.className = 'grid-disc';
                gridDisc.dataset.character = char.id;
                
                const img = document.createElement('img');
                img.src = `../assets/cast/cast-members/${char.id}-disc.png`;
                img.alt = char.name;
                
                gridDisc.appendChild(img);
                grid.appendChild(gridDisc);

                // Click handler
                gridDisc.addEventListener('click', () => selectCharacter(char));
            });
        }

        // Update carousel positions
        window.updateCarousel = function() {
            const sleeves = document.querySelectorAll('.disc-sleeve');
            
            sleeves.forEach((sleeve, index) => {
                sleeve.classList.remove('active', 'prev', 'next', 'far-prev', 'far-next');
                
                const diff = index - window.currentIndex;
                
                if (diff === 0) {
                    sleeve.classList.add('active');
                } else if (diff === -1 || (diff > 0 && diff === window.availableCharacters.length - 1)) {
                    sleeve.classList.add('prev');
                } else if (diff === 1 || (diff < 0 && Math.abs(diff) === window.availableCharacters.length - 1)) {
                    sleeve.classList.add('next');
                } else {
                    sleeve.classList.add(diff < 0 ? 'far-prev' : 'far-next');
                }
            });
        };

        // Navigate carousel
        window.navigateCarousel = function(direction) {
            if (direction === 'prev') {
                window.currentIndex = (window.currentIndex - 1 + window.availableCharacters.length) % window.availableCharacters.length;
            } else {
                window.currentIndex = (window.currentIndex + 1) % window.availableCharacters.length;
            }
            updateCarousel();
        };

        // Character selection
        window.selectCharacter = function(character) {
            window.currentCharacter = character;
            window.selectedWeapons = {};  // Reset to empty object
            
            // Update modal content
            document.getElementById('modalDiscImg').src = `../assets/cast/cast-members/${character.id}-disc.png`;
            document.getElementById('characterName').textContent = character.name;
            document.getElementById('characterShow').textContent = character.show;
            
            // Reset checkout state
            document.getElementById('checkoutBtn').style.display = 'block';
            document.getElementById('paymentModal').style.display = 'none';
            document.getElementById('startOverBtn').style.display = 'none';
            document.getElementById('checkoutBtn').disabled = false;
            document.getElementById('checkoutBtn').textContent = 'CHECKOUT ‚Üí';
            
            // Generate weapons grid
            const weaponsGrid = document.getElementById('weaponsGrid');
            weaponsGrid.innerHTML = '';
            
            weapons.forEach((weapon, index) => {
                const weaponEl = document.createElement('div');
                weaponEl.className = 'weapon-item';
                weaponEl.dataset.index = index;
                weaponEl.innerHTML = `
                    <div class="weapon-name">${weapon.name}</div>
                    <div class="weapon-emoji">${weapon.emoji}</div>
                    <div class="weapon-quantity">0</div>
                `;
                
                weaponEl.addEventListener('click', () => toggleWeapon(index));
                weaponsGrid.appendChild(weaponEl);
            });
            
            updateTotal();
            document.getElementById('modalOverlay').classList.add('active');
        };

        // Toggle weapon selection - now with quantities
        window.toggleWeapon = function(index) {
            console.log('Toggle weapon called with index:', index);
            const weaponEl = document.querySelector(`.weapon-item[data-index="${index}"]`);
            if (!weaponEl) {
                console.error('Weapon element not found for index:', index);
                return;
            }
            
            let quantityEl = weaponEl.querySelector('.weapon-quantity');
            if (!quantityEl) {
                console.error('Quantity element not found, creating one');
                // Create quantity element if it doesn't exist
                quantityEl = document.createElement('div');
                quantityEl.className = 'weapon-quantity';
                quantityEl.style.display = 'none';
                weaponEl.appendChild(quantityEl);
            }
            
            if (!window.selectedWeapons[index]) {
                window.selectedWeapons[index] = 0;
            }
            
            window.selectedWeapons[index]++;
            weaponEl.classList.add('selected');
            quantityEl.textContent = window.selectedWeapons[index];
            quantityEl.style.display = 'block';
            
            updateTotal();
        };

        // Update total price
        window.updateTotal = function() {
            let total = 0;
            for (const [index, quantity] of Object.entries(window.selectedWeapons)) {
                total += weapons[index].price * quantity;
            }
            
            const totalDiv = document.getElementById('totalPriceDiv');
            if (total > 0) {
                totalDiv.innerHTML = `TOTAL: ${total}`;
            } else {
                totalDiv.innerHTML = 'SELECT YOUR TOOLS!';
            }
        };

        // Proceed to checkout
        window.proceedToCheckout = async function() {
            if (!window.currentCharacter || !window.currentAccessCode) return;
            
            const btn = document.getElementById('checkoutBtn');
            btn.disabled = true;
            btn.textContent = 'SUBMITTING...';
            
            try {
                const selectedTools = [];
                let totalCost = 0;
                
                // Convert quantity object to array of tools
                for (const [index, quantity] of Object.entries(window.selectedWeapons)) {
                    const weapon = weapons[index];
                    for (let i = 0; i < quantity; i++) {
                        selectedTools.push({ name: weapon.name, price: weapon.price });
                        totalCost += weapon.price;
                    }
                }
                
                const selectionData = {
                    accessCode: window.currentAccessCode,
                    characterId: window.currentCharacter.id,
                    characterName: window.currentCharacter.name,
                    tools: selectedTools,
                    totalCost: totalCost,
                    status: 'pending',
                    submittedAt: new Date().toISOString()
                };
                
                await addDoc(collection(db, 'pendingSelections'), selectionData);
                
                // Update payment message
                const paymentMsg = document.getElementById('paymentMessage');
                if (totalCost > 0) {
                    paymentMsg.innerHTML = `so excited to play with you! Send ${totalCost} via venmo or zelle and standby for approval!`;
                } else {
                    paymentMsg.innerHTML = `so excited to play with you! Your selection has been sent for approval!`;
                }
                
                // Show payment instructions
                document.getElementById('checkoutBtn').style.display = 'none';
                document.getElementById('paymentModal').style.display = 'block';
                document.getElementById('startOverBtn').style.display = 'block';
                
            } catch (error) {
                console.error('Error submitting selection:', error);
                alert('Error submitting selection. Please try again.');
                btn.disabled = false;
                btn.textContent = 'CHECKOUT ‚Üí';
            }
        };

        // Start over - clear selection and close modal
        window.startOver = function() {
            closeModal();
            // Clear pending selection from database
            checkPendingSelection(window.currentAccessCode);
        };

        // Close modal
        window.closeModal = function() {
            document.getElementById('modalOverlay').classList.remove('active');
            window.selectedWeapons = {};  // Reset to empty object
            window.currentCharacter = null;
        };

        // Touch handling
        document.addEventListener('touchstart', (e) => {
            window.touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', (e) => {
            window.touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            if (window.currentView === 'carousel') {
                if (window.touchEndX < window.touchStartX - 50) {
                    navigateCarousel('next');
                }
                if (window.touchEndX > window.touchStartX + 50) {
                    navigateCarousel('prev');
                }
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') navigateCarousel('prev');
            if (e.key === 'ArrowRight') navigateCarousel('next');
            if (e.key === 'Escape') closeModal();
        });

        // Enter key for access code
        document.getElementById('accessCodeInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                validateAccessCode();
            }
        });
    </script>
</body>
</html>